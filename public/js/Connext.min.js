var JSON;if(!function(n){"use strict";var t=function(n,t){this.init(n,t)};t.prototype={constructor:t,init:function(t,i){var u=this,r;this.options=i;this.$element=n(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",n.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote,function(){var t=n.Event("loaded");u.$element.trigger(t)});r=typeof this.options.manager=="function"?this.options.manager.call(this):this.options.manager;r=r.appendModal?r:n(r).modalmanager().data("modalmanager");r.appendModal(this)},toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=n.Event("show");this.isShown||(this.$element.trigger(t),t.isDefaultPrevented())||(this.escape(),this.tab(),this.options.loading&&this.loading())},hide:function(t){(t&&t.preventDefault(),t=n.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented())&&(this.isShown=!1,this.escape(),this.tab(),this.isLoading&&this.loading(),n(document).off("focusin.modal"),this.$element.removeClass("in").removeClass("animated").removeClass(this.options.attentionAnimation).removeClass("modal-overflow").attr("aria-hidden",!0),n.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},layout:function(){var i=this.options.height?"height":"max-height",r=this.options.height||this.options.maxHeight,t,u;this.options.width?(this.$element.css("width",this.options.width),t=this,this.$element.css("margin-left",function(){return/%/ig.test(t.options.width)?-(parseInt(t.options.width)/2)+"%":-(n(this).width()/2)+"px"})):(this.$element.css("width",""),this.$element.css("margin-left",""));this.$element.find(".modal-body").css("overflow","").css(i,"");r&&this.$element.find(".modal-body").css("overflow","auto").css(i,r);u=n(window).height()-10<this.$element.height();u||this.options.modalOverflow?this.$element.css("margin-top",0).addClass("modal-overflow"):this.$element.css("margin-top",0-this.$element.height()/2).removeClass("modal-overflow")},tab:function(){var t=this;if(this.isShown&&this.options.consumeTab)this.$element.on("keydown.tabindex.modal","[data-tabindex]",function(i){var r,f,u;i.keyCode&&i.keyCode==9&&(r=[],f=Number(n(this).data("tabindex")),t.$element.find("[data-tabindex]:enabled:visible:not([readonly])").each(function(){r.push(Number(n(this).data("tabindex")))}),r.sort(function(n,t){return n-t}),u=n.inArray(f,r),i.shiftKey?u==0?t.$element.find("[data-tabindex="+r[r.length-1]+"]").focus():t.$element.find("[data-tabindex="+r[u-1]+"]").focus():u<r.length-1?t.$element.find("[data-tabindex="+r[u+1]+"]").focus():t.$element.find("[data-tabindex="+r[0]+"]").focus(),i.preventDefault())});else this.isShown||this.$element.off("keydown.tabindex.modal")},escape:function(){var n=this;if(this.isShown&&this.options.keyboard){this.$element.attr("tabindex")||this.$element.attr("tabindex",-1);this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&n.hide()})}else this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,i=setTimeout(function(){t.$element.off(n.support.transition.end);t.hideModal()},500);this.$element.one(n.support.transition.end,function(){clearTimeout(i);t.hideModal()})},hideModal:function(){var n=this.options.height?"height":"max-height",t=this.options.height||this.options.maxHeight;t&&this.$element.find(".modal-body").css("overflow","").css(n,"");this.$element.hide().trigger("hidden")},removeLoading:function(){this.$loading.remove();this.$loading=null;this.isLoading=!1},loading:function(t){var i,r,u;t=t||function(){};i=this.$element.hasClass("fade")?"fade":"";this.isLoading?this.isLoading&&this.$loading?(this.$loading.removeClass("in"),u=this,n.support.transition&&this.$element.hasClass("fade")?this.$loading.one(n.support.transition.end,function(){u.removeLoading()}):u.removeLoading()):t&&t(this.isLoading):(r=n.support.transition&&i,this.$loading=n('<div class="loading-mask '+i+'">').append(this.options.spinner).appendTo(this.$element),r&&this.$loading[0].offsetWidth,this.$loading.addClass("in"),this.isLoading=!0,r?this.$loading.one(n.support.transition.end,t):t())},focus:function(){var n=this.$element.find(this.options.focusOn);n=n.length?n:this.$element;n.focus()},attention:function(){if(this.options.attentionAnimation){this.$element.removeClass("animated").removeClass(this.options.attentionAnimation);var n=this;setTimeout(function(){n.$element.addClass("animated").addClass(n.options.attentionAnimation)},0)}this.focus()},destroy:function(){var t=n.Event("destroy");(this.$element.trigger(t),t.isDefaultPrevented())||(this.$element.off(".connextmodal").removeData("modal").removeClass("in").attr("aria-hidden",!0),this.$parent!==this.$element.parent()?this.$element.appendTo(this.$parent):this.$parent.length||(this.$element.remove(),this.$element=null),this.$element.trigger("destroyed"))}};n.fn.connextmodal=function(i,r){return this.each(function(){var f=n(this),u=f.data("modal"),e=n.extend({},n.fn.connextmodal.defaults,f.data(),typeof i=="object"&&i);u||f.data("modal",u=new t(this,e));typeof i=="string"?u[i].apply(u,[].concat(r)):e.show&&u.show()})};n.fn.connextmodal.defaults={keyboard:!0,backdrop:!0,loading:!1,show:!0,width:null,height:null,maxHeight:null,modalOverflow:!1,consumeTab:!0,focusOn:null,replace:!1,resize:!1,attentionAnimation:"shake",manager:"body",spinner:'<div class="loading-spinner" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"><\/div><\/div><\/div>',backdropTemplate:'<div class="modal-backdrop" />'};n.fn.connextmodal.Constructor=t;n(function(){n(document).off("click.modal").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var i=n(this),r=i.attr("href"),u=n(i.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),f=u.data("modal")?"toggle":n.extend({remote:!/#/.test(r)&&r},u.data(),i.data());t.preventDefault();u.connextmodal(f).one("hide",function(){i.focus()})})})}(window.jQuery),!function(n){"use strict";function t(n){return function(t){if(t&&this===t.target)return n.apply(this,arguments)}}var r=function(n,t){this.init(n,t)},i;r.prototype={constructor:r,init:function(t,i){if(this.$element=n(t),this.options=n.extend({},n.fn.modalmanager.defaults,this.$element.data(),typeof i=="object"&&i),this.stack=[],this.backdropCount=0,this.options.resize){var r,u=this;n(window).on("resize.modal",function(){r&&clearTimeout(r);r=setTimeout(function(){for(var n=0;n<u.stack.length;n++)u.stack[n].isShown&&u.stack[n].layout()},10)})}},createModal:function(t,i){n(t).modal(n.extend({manager:this},i))},appendModal:function(i){this.stack.push(i);var r=this;i.$element.on("show.modalmanager",t(function(){var t=function(){i.isShown=!0;var t=n.support.transition&&i.$element.hasClass("fade");r.$element.toggleClass("modal-open",r.hasOpenModal()).toggleClass("page-overflow",n(window).height()<r.$element.height());i.$parent=i.$element.parent();i.$container=r.createContainer(i);i.$element.appendTo(i.$container);r.backdrop(i,function(){i.$element.show();t&&i.$element[0].offsetWidth;i.layout();i.$element.addClass("in").attr("aria-hidden",!1);var u=function(){r.setFocus();i.$element.trigger("shown")};t?i.$element.one(n.support.transition.end,u):u()})};i.options.replace?r.replace(t):t()}));i.$element.on("hidden.modalmanager",t(function(){if(r.backdrop(i),r.destroyModal(i),i.$element.parent().length)if(i.$backdrop){var t=n.support.transition&&i.$element.hasClass("fade");t&&i.$element[0].offsetWidth;n.support.transition&&i.$element.hasClass("fade")?i.$backdrop.one(n.support.transition.end,function(){i.destroy()}):i.destroy()}else i.destroy();else r.destroyModal(i)}));i.$element.on("destroyed.modalmanager",t(function(){r.destroyModal(i)}))},getOpenModals:function(){for(var t=[],n=0;n<this.stack.length;n++)this.stack[n].isShown&&t.push(this.stack[n]);return t},hasOpenModal:function(){return this.getOpenModals().length>0},setFocus:function(){for(var t,n=0;n<this.stack.length;n++)this.stack[n].isShown&&(t=this.stack[n]);t&&t.focus()},destroyModal:function(n){n.$element.off(".modalmanager");n.$backdrop&&this.removeBackdrop(n);this.stack.splice(this.getIndexOfModal(n),1);var t=this.hasOpenModal();this.$element.toggleClass("modal-open",t);t||this.$element.removeClass("page-overflow");this.removeContainer(n);this.setFocus()},getModalAt:function(n){return this.stack[n]},getIndexOfModal:function(n){for(var t=0;t<this.stack.length;t++)if(n===this.stack[t])return t},replace:function(i){for(var r,u=0;u<this.stack.length;u++)this.stack[u].isShown&&(r=this.stack[u]);r?(this.$backdropHandle=r.$backdrop,r.$backdrop=null,i&&r.$element.one("hidden",t(n.proxy(i,this))),r.hide()):i&&i()},removeBackdrop:function(n){n.$backdrop.remove();n.$backdrop=null},createBackdrop:function(t,i){var r;return this.$backdropHandle?(r=this.$backdropHandle,r.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):r=n(i).addClass(t).appendTo(this.$element),r},removeContainer:function(n){n.$container.remove();n.$container=null},createContainer:function(r){var u;if(u=n('<div class="modal-scrollable">').css("z-index",i("modal",this.getOpenModals().length)).appendTo(this.$element),r&&r.options.backdrop!="static")u.on("click.modal",t(function(){r.hide()}));else if(r)u.on("click.modal",t(function(){r.attention()}));return u},backdrop:function(t,r){var e=t.$element.hasClass("fade")?"fade":"",o=t.options.backdrop&&this.backdropCount<this.options.backdropLimit,u,f;t.isShown&&o?(u=n.support.transition&&e&&!this.$backdropHandle,t.$backdrop=this.createBackdrop(e,t.options.backdropTemplate),t.$backdrop.css("z-index",i("backdrop",this.getOpenModals().length)),u&&t.$backdrop[0].offsetWidth,t.$backdrop.addClass("in"),this.backdropCount+=1,u?t.$backdrop.one(n.support.transition.end,r):r()):!t.isShown&&t.$backdrop?(t.$backdrop.removeClass("in"),this.backdropCount-=1,f=this,n.support.transition&&t.$element.hasClass("fade")?t.$backdrop.one(n.support.transition.end,function(){f.removeBackdrop(t)}):f.removeBackdrop(t)):r&&r()},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(t){var r,f,u;t=t||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",n(window).height()<this.$element.height());this.isLoading?this.isLoading&&this.$backdropHandle?(this.$backdropHandle.removeClass("in"),u=this,n.support.transition?this.$backdropHandle.one(n.support.transition.end,function(){u.removeLoading()}):u.removeLoading()):t&&t(this.isLoading):(this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate),this.$backdropHandle[0].offsetWidth,r=this.getOpenModals(),this.$backdropHandle.css("z-index",i("backdrop",r.length+1)).addClass("in"),f=n(this.options.spinner).css("z-index",i("modal",r.length+1)).appendTo(this.$element).addClass("in"),this.$spinner=n(this.createContainer()).append(f).on("click.modalmanager",n.proxy(this.loading,this)),this.isLoading=!0,n.support.transition?this.$backdropHandle.one(n.support.transition.end,t):t())}};i=function(){var i,t={};return function(r,u){if(typeof i=="undefined"){var f=n('<div class="modal hide" />').appendTo("body"),e=n('<div class="modal-backdrop hide" />').appendTo("body");t.modal=+f.css("z-index");t.backdrop=+e.css("z-index");i=t.modal-t.backdrop;f.remove();e.remove();e=f=null}return t[r]+i*u}}();n.fn.modalmanager=function(t,i){return this.each(function(){var f=n(this),u=f.data("modalmanager");u||f.data("modalmanager",u=new r(this,t));typeof t=="string"&&u[t].apply(u,[].concat(i))})};n.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"><\/div><\/div><\/div>',backdropTemplate:'<div class="modal-backdrop" />'};n.fn.modalmanager.Constructor=r;n(function(){n(document).off("show.bs.modal").off("hidden.bs.modal")})}(jQuery),typeof jQuery=="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");+function(n){"use strict";var t=n.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||t[0]==1&&t[1]==9&&t[2]<1||t[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4");}(jQuery);+function(n){"use strict";function i(i){return this.each(function(){var u=n(this),r=u.data("bs.affix"),f=typeof i=="object"&&i;r||u.data("bs.affix",r=new t(this,f));typeof i=="string"&&r[i]()})}var t=function(i,r){this.options=n.extend({},t.DEFAULTS,r);this.$target=n(this.options.target).on("scroll.bs.affix.data-api",n.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",n.proxy(this.checkPositionWithEventLoop,this));this.$element=n(i);this.affixed=null;this.unpin=null;this.pinnedOffset=null;this.checkPosition()},r;t.VERSION="3.3.7";t.RESET="affix affix-top affix-bottom";t.DEFAULTS={offset:0,target:window};t.prototype.getState=function(n,t,i,r){var u=this.$target.scrollTop(),f=this.$element.offset(),e=this.$target.height();if(i!=null&&this.affixed=="top")return u<i?"top":!1;if(this.affixed=="bottom")return i!=null?u+this.unpin<=f.top?!1:"bottom":u+e<=n-r?!1:"bottom";var o=this.affixed==null,s=o?u:f.top,h=o?e:t;return i!=null&&u<=i?"top":r!=null&&s+h>=n-r?"bottom":!1};t.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(t.RESET).addClass("affix");var n=this.$target.scrollTop(),i=this.$element.offset();return this.pinnedOffset=i.top-n};t.prototype.checkPositionWithEventLoop=function(){setTimeout(n.proxy(this.checkPosition,this),1)};t.prototype.checkPosition=function(){var i,e,o;if(this.$element.is(":visible")){var s=this.$element.height(),r=this.options.offset,f=r.top,u=r.bottom,h=Math.max(n(document).height(),n(document.body).height());if(typeof r!="object"&&(u=f=r),typeof f=="function"&&(f=r.top(this.$element)),typeof u=="function"&&(u=r.bottom(this.$element)),i=this.getState(h,s,f,u),this.affixed!=i){if(this.unpin!=null&&this.$element.css("top",""),e="affix"+(i?"-"+i:""),o=n.Event(e+".bs.affix"),this.$element.trigger(o),o.isDefaultPrevented())return;this.affixed=i;this.unpin=i=="bottom"?this.getPinnedOffset():null;this.$element.removeClass(t.RESET).addClass(e).trigger(e.replace("affix","affixed")+".bs.affix")}i=="bottom"&&this.$element.offset({top:h-s-u})}};r=n.fn.affix;n.fn.affix=i;n.fn.affix.Constructor=t;n.fn.affix.noConflict=function(){return n.fn.affix=r,this};n(window).on("load",function(){n('[data-spy="affix"]').each(function(){var r=n(this),t=r.data();t.offset=t.offset||{};t.offsetBottom!=null&&(t.offset.bottom=t.offsetBottom);t.offsetTop!=null&&(t.offset.top=t.offsetTop);i.call(r,t)})})}(jQuery),function(){var y=this,at=y._,s={},r=Array.prototype,g=Object.prototype,vt=Function.prototype,nt=r.push,t=r.slice,u=r.concat,e=g.toString,yt=g.hasOwnProperty,tt=r.forEach,it=r.map,rt=r.reduce,ut=r.reduceRight,ft=r.filter,et=r.every,ot=r.some,h=r.indexOf,st=r.lastIndexOf,pt=Array.isArray,ht=Object.keys,p=vt.bind,n=function(t){if(t instanceof n)return t;if(!(this instanceof n))return new n(t);this._wrapped=t},i,w,b,o,c,k,l,a,f,ct,lt,v;typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports._=n):y._=n;n.VERSION="1.6.0";i=n.each=n.forEach=function(t,i,r){var e,u,f;if(t==null)return t;if(tt&&t.forEach===tt)t.forEach(i,r);else if(t.length===+t.length){for(u=0,f=t.length;u<f;u++)if(i.call(r,t[u],u,t)===s)return}else for(e=n.keys(t),u=0,f=e.length;u<f;u++)if(i.call(r,t[e[u]],e[u],t)===s)return;return t};n.map=n.collect=function(n,t,r){var u=[];return n==null?u:it&&n.map===it?n.map(t,r):(i(n,function(n,i,f){u.push(t.call(r,n,i,f))}),u)};w="Reduce of empty array with no initial value";n.reduce=n.foldl=n.inject=function(t,r,u,f){var e=arguments.length>2;if(t==null&&(t=[]),rt&&t.reduce===rt)return f&&(r=n.bind(r,f)),e?t.reduce(r,u):t.reduce(r);if(i(t,function(n,t,i){e?u=r.call(f,u,n,t,i):(u=n,e=!0)}),!e)throw new TypeError(w);return u};n.reduceRight=n.foldr=function(t,r,u,f){var o=arguments.length>2,e,s;if(t==null&&(t=[]),ut&&t.reduceRight===ut)return f&&(r=n.bind(r,f)),o?t.reduceRight(r,u):t.reduceRight(r);if(e=t.length,e!==+e&&(s=n.keys(t),e=s.length),i(t,function(n,i,h){i=s?s[--e]:--e;o?u=r.call(f,u,t[i],i,h):(u=t[i],o=!0)}),!o)throw new TypeError(w);return u};n.find=n.detect=function(n,t,i){var r;return b(n,function(n,u,f){if(t.call(i,n,u,f))return r=n,!0}),r};n.filter=n.select=function(n,t,r){var u=[];return n==null?u:ft&&n.filter===ft?n.filter(t,r):(i(n,function(n,i,f){t.call(r,n,i,f)&&u.push(n)}),u)};n.reject=function(t,i,r){return n.filter(t,function(n,t,u){return!i.call(r,n,t,u)},r)};n.every=n.all=function(t,r,u){r||(r=n.identity);var f=!0;return t==null?f:et&&t.every===et?t.every(r,u):(i(t,function(n,t,i){if(!(f=f&&r.call(u,n,t,i)))return s}),!!f)};b=n.some=n.any=function(t,r,u){r||(r=n.identity);var f=!1;return t==null?f:ot&&t.some===ot?t.some(r,u):(i(t,function(n,t,i){if(f||(f=r.call(u,n,t,i)))return s}),!!f)};n.contains=n.include=function(n,t){return n==null?!1:h&&n.indexOf===h?n.indexOf(t)!=-1:b(n,function(n){return n===t})};n.invoke=function(i,r){var u=t.call(arguments,2),f=n.isFunction(r);return n.map(i,function(n){return(f?r:n[r]).apply(n,u)})};n.pluck=function(t,i){return n.map(t,n.property(i))};n.where=function(t,i){return n.filter(t,n.matches(i))};n.findWhere=function(t,i){return n.find(t,n.matches(i))};n.max=function(t,r,u){if(!r&&n.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var f=-Infinity,e=-Infinity;return i(t,function(n,t,i){var o=r?r.call(u,n,t,i):n;o>e&&(f=n,e=o)}),f};n.min=function(t,r,u){if(!r&&n.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var f=Infinity,e=Infinity;return i(t,function(n,t,i){var o=r?r.call(u,n,t,i):n;o<e&&(f=n,e=o)}),f};n.shuffle=function(t){var u,f=0,r=[];return i(t,function(t){u=n.random(f++);r[f-1]=r[u];r[u]=t}),r};n.sample=function(t,i,r){return i==null||r?(t.length!==+t.length&&(t=n.values(t)),t[n.random(t.length-1)]):n.shuffle(t).slice(0,Math.max(0,i))};o=function(t){return t==null?n.identity:n.isFunction(t)?t:n.property(t)};n.sortBy=function(t,i,r){return i=o(i),n.pluck(n.map(t,function(n,t,u){return{value:n,index:t,criteria:i.call(r,n,t,u)}}).sort(function(n,t){var i=n.criteria,r=t.criteria;if(i!==r){if(i>r||i===void 0)return 1;if(i<r||r===void 0)return-1}return n.index-t.index}),"value")};c=function(n){return function(t,r,u){var f={};return r=o(r),i(t,function(i,e){var o=r.call(u,i,e,t);n(f,o,i)}),f}};n.groupBy=c(function(t,i,r){n.has(t,i)?t[i].push(r):t[i]=[r]});n.indexBy=c(function(n,t,i){n[t]=i});n.countBy=c(function(t,i){n.has(t,i)?t[i]++:t[i]=1});n.sortedIndex=function(n,t,i,r){var f;i=o(i);for(var s=i.call(r,t),u=0,e=n.length;u<e;)f=u+e>>>1,i.call(r,n[f])<s?u=f+1:e=f;return u};n.toArray=function(i){return i?n.isArray(i)?t.call(i):i.length===+i.length?n.map(i,n.identity):n.values(i):[]};n.size=function(t){return t==null?0:t.length===+t.length?t.length:n.keys(t).length};n.first=n.head=n.take=function(n,i,r){if(n!=null)return i==null||r?n[0]:i<0?[]:t.call(n,0,i)};n.initial=function(n,i,r){return t.call(n,0,n.length-(i==null||r?1:i))};n.last=function(n,i,r){if(n!=null)return i==null||r?n[n.length-1]:t.call(n,Math.max(n.length-i,0))};n.rest=n.tail=n.drop=function(n,i,r){return t.call(n,i==null||r?1:i)};n.compact=function(t){return n.filter(t,n.identity)};k=function(t,r,f){return r&&n.every(t,n.isArray)?u.apply(f,t):(i(t,function(t){n.isArray(t)||n.isArguments(t)?r?nt.apply(f,t):k(t,r,f):f.push(t)}),f)};n.flatten=function(n,t){return k(n,t,[])};n.without=function(i){return n.difference(i,t.call(arguments,1))};n.partition=function(n,t,r){t=o(t);var u=[],f=[];return i(n,function(n){(t.call(r,n)?u:f).push(n)}),[u,f]};n.uniq=n.unique=function(t,r,u,f){n.isFunction(r)&&(f=u,u=r,r=!1);var s=u?n.map(t,u,f):t,o=[],e=[];return i(s,function(i,u){(r?u&&e[e.length-1]===i:n.contains(e,i))||(e.push(i),o.push(t[u]))}),o};n.union=function(){return n.uniq(n.flatten(arguments,!0))};n.intersection=function(i){var r=t.call(arguments,1);return n.filter(n.uniq(i),function(t){return n.every(r,function(i){return n.contains(i,t)})})};n.difference=function(i){var f=u.apply(r,t.call(arguments,1));return n.filter(i,function(t){return!n.contains(f,t)})};n.zip=function(){for(var i=n.max(n.pluck(arguments,"length").concat(0)),r=new Array(i),t=0;t<i;t++)r[t]=n.pluck(arguments,""+t);return r};n.object=function(n,t){var r,i,u;if(n==null)return{};for(r={},i=0,u=n.length;i<u;i++)t?r[n[i]]=t[i]:r[n[i][0]]=n[i][1];return r};n.indexOf=function(t,i,r){if(t==null)return-1;var u=0,f=t.length;if(r)if(typeof r=="number")u=r<0?Math.max(0,f+r):r;else return u=n.sortedIndex(t,i),t[u]===i?u:-1;if(h&&t.indexOf===h)return t.indexOf(i,r);for(;u<f;u++)if(t[u]===i)return u;return-1};n.lastIndexOf=function(n,t,i){var u,r;if(n==null)return-1;if(u=i!=null,st&&n.lastIndexOf===st)return u?n.lastIndexOf(t,i):n.lastIndexOf(t);for(r=u?i:n.length;r--;)if(n[r]===t)return r;return-1};n.range=function(n,t,i){arguments.length<=1&&(t=n||0,n=0);i=arguments[2]||1;for(var r=Math.max(Math.ceil((t-n)/i),0),u=0,f=new Array(r);u<r;)f[u++]=n,n+=i;return f};l=function(){};n.bind=function(i,r){var u,f;if(p&&i.bind===p)return p.apply(i,t.call(arguments,1));if(!n.isFunction(i))throw new TypeError;return u=t.call(arguments,2),f=function(){var e,n;return(this instanceof f)?(l.prototype=i.prototype,e=new l,l.prototype=null,n=i.apply(e,u.concat(t.call(arguments))),Object(n)===n)?n:e:i.apply(r,u.concat(t.call(arguments)))}};n.partial=function(i){var r=t.call(arguments,1);return function(){for(var f=0,t=r.slice(),u=0,e=t.length;u<e;u++)t[u]===n&&(t[u]=arguments[f++]);while(f<arguments.length)t.push(arguments[f++]);return i.apply(this,t)}};n.bindAll=function(r){var u=t.call(arguments,1);if(u.length===0)throw new Error("bindAll must be passed function names");return i(u,function(t){r[t]=n.bind(r[t],r)}),r};n.memoize=function(t,i){var r={};return i||(i=n.identity),function(){var u=i.apply(this,arguments);return n.has(r,u)?r[u]:r[u]=t.apply(this,arguments)}};n.delay=function(n,i){var r=t.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},i)};n.defer=function(i){return n.delay.apply(n,[i,1].concat(t.call(arguments,1)))};n.throttle=function(t,i,r){var u,f,s,e=null,o=0,h;return r||(r={}),h=function(){o=r.leading===!1?0:n.now();e=null;s=t.apply(u,f);u=f=null},function(){var c=n.now(),l;return o||r.leading!==!1||(o=c),l=i-(c-o),u=this,f=arguments,l<=0?(clearTimeout(e),e=null,o=c,s=t.apply(u,f),u=f=null):e||r.trailing===!1||(e=setTimeout(h,l)),s}};n.debounce=function(t,i,r){var u,f,e,s,o,h=function(){var c=n.now()-s;c<i?u=setTimeout(h,i-c):(u=null,r||(o=t.apply(e,f),e=f=null))};return function(){e=this;f=arguments;s=n.now();var c=r&&!u;return u||(u=setTimeout(h,i)),c&&(o=t.apply(e,f),e=f=null),o}};n.once=function(n){var i=!1,t;return function(){return i?t:(i=!0,t=n.apply(this,arguments),n=null,t)}};n.wrap=function(t,i){return n.partial(i,t)};n.compose=function(){var n=arguments;return function(){for(var t=arguments,i=n.length-1;i>=0;i--)t=[n[i].apply(this,t)];return t[0]}};n.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}};n.keys=function(t){var i,r;if(!n.isObject(t))return[];if(ht)return ht(t);i=[];for(r in t)n.has(t,r)&&i.push(r);return i};n.values=function(t){for(var r=n.keys(t),u=r.length,f=new Array(u),i=0;i<u;i++)f[i]=t[r[i]];return f};n.pairs=function(t){for(var r=n.keys(t),u=r.length,f=new Array(u),i=0;i<u;i++)f[i]=[r[i],t[r[i]]];return f};n.invert=function(t){for(var u={},r=n.keys(t),i=0,f=r.length;i<f;i++)u[t[r[i]]]=r[i];return u};n.functions=n.methods=function(t){var i=[];for(var r in t)n.isFunction(t[r])&&i.push(r);return i.sort()};n.extend=function(n){return i(t.call(arguments,1),function(t){if(t)for(var i in t)n[i]=t[i]}),n};n.pick=function(n){var f={},e=u.apply(r,t.call(arguments,1));return i(e,function(t){t in n&&(f[t]=n[t])}),f};n.omit=function(i){var e={},o=u.apply(r,t.call(arguments,1));for(var f in i)n.contains(o,f)||(e[f]=i[f]);return e};n.defaults=function(n){return i(t.call(arguments,1),function(t){if(t)for(var i in t)n[i]===void 0&&(n[i]=t[i])}),n};n.clone=function(t){return n.isObject(t)?n.isArray(t)?t.slice():n.extend({},t):t};n.tap=function(n,t){return t(n),n};a=function(t,i,r,u){var l,v,h,c,f,o,s;if(t===i)return t!==0||1/t==1/i;if(t==null||i==null)return t===i;if(t instanceof n&&(t=t._wrapped),i instanceof n&&(i=i._wrapped),l=e.call(t),l!=e.call(i))return!1;switch(l){case"[object String]":return t==String(i);case"[object Number]":return t!=+t?i!=+i:t==0?1/t==1/i:t==+i;case"[object Date]":case"[object Boolean]":return+t==+i;case"[object RegExp]":return t.source==i.source&&t.global==i.global&&t.multiline==i.multiline&&t.ignoreCase==i.ignoreCase}if(typeof t!="object"||typeof i!="object")return!1;for(v=r.length;v--;)if(r[v]==t)return u[v]==i;if(h=t.constructor,c=i.constructor,h!==c&&!(n.isFunction(h)&&h instanceof h&&n.isFunction(c)&&c instanceof c)&&"constructor"in t&&"constructor"in i)return!1;if(r.push(t),u.push(i),f=0,o=!0,l=="[object Array]"){if(f=t.length,o=f==i.length,o)while(f--)if(!(o=a(t[f],i[f],r,u)))break}else{for(s in t)if(n.has(t,s)&&(f++,!(o=n.has(i,s)&&a(t[s],i[s],r,u))))break;if(o){for(s in i)if(n.has(i,s)&&!f--)break;o=!f}}return r.pop(),u.pop(),o};n.isEqual=function(n,t){return a(n,t,[],[])};n.isEmpty=function(t){if(t==null)return!0;if(n.isArray(t)||n.isString(t))return t.length===0;for(var i in t)if(n.has(t,i))return!1;return!0};n.isElement=function(n){return!!(n&&n.nodeType===1)};n.isArray=pt||function(n){return e.call(n)=="[object Array]"};n.isObject=function(n){return n===Object(n)};i(["Arguments","Function","String","Number","Date","RegExp"],function(t){n["is"+t]=function(n){return e.call(n)=="[object "+t+"]"}});n.isArguments(arguments)||(n.isArguments=function(t){return!!(t&&n.has(t,"callee"))});typeof/./!="function"&&(n.isFunction=function(n){return typeof n=="function"});n.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))};n.isNaN=function(t){return n.isNumber(t)&&t!=+t};n.isBoolean=function(n){return n===!0||n===!1||e.call(n)=="[object Boolean]"};n.isNull=function(n){return n===null};n.isUndefined=function(n){return n===void 0};n.has=function(n,t){return yt.call(n,t)};n.noConflict=function(){return y._=at,this};n.identity=function(n){return n};n.constant=function(n){return function(){return n}};n.property=function(n){return function(t){return t[n]}};n.matches=function(n){return function(t){if(t===n)return!0;for(var i in n)if(String(n[i])!==String(t[i]))return!1;return!0}};n.times=function(n,t,i){for(var u=Array(Math.max(0,n)),r=0;r<n;r++)u[r]=t.call(i,r);return u};n.random=function(n,t){return t==null&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};n.now=Date.now||function(){return(new Date).getTime()};f={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};f.unescape=n.invert(f.escape);ct={escape:new RegExp("["+n.keys(f.escape).join("")+"]","g"),unescape:new RegExp("("+n.keys(f.unescape).join("|")+")","g")};n.each(["escape","unescape"],function(t){n[t]=function(n){return n==null?"":(""+n).replace(ct[t],function(n){return f[t][n]})}});n.result=function(t,i){if(t==null)return void 0;var r=t[i];return n.isFunction(r)?r.call(t):r};n.mixin=function(t){i(n.functions(t),function(i){var r=n[i]=t[i];n.prototype[i]=function(){var t=[this._wrapped];return nt.apply(t,arguments),v.call(this,r.apply(n,t))}})};lt=0;n.uniqueId=function(n){var t=++lt+"";return n?n+t:t};n.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var d=/(.)^/,wt={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},bt=/\\|'|\r|\n|\t|\u2028|\u2029/g;n.template=function(t,i,r){var f,e;r=n.defaults({},r,n.templateSettings);var h=new RegExp([(r.escape||d).source,(r.interpolate||d).source,(r.evaluate||d).source].join("|")+"|$","g"),o=0,u="__p+='";t.replace(h,function(n,i,r,f,e){return u+=t.slice(o,e).replace(bt,function(n){return"\\"+wt[n]}),i&&(u+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),r&&(u+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),f&&(u+="';\n"+f+"\n__p+='"),o=e+n.length,n});u+="';\n";r.variable||(u="with(obj||{}){\n"+u+"}\n");u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{f=new Function(r.variable||"obj","_",u)}catch(s){s.source=u;throw s;}return i?f(i,n):(e=function(t){return f.call(this,t,n)},e.source="function("+(r.variable||"obj")+"){\n"+u+"}",e)};n.chain=function(t){return n(t).chain()};n.findByKey=function(t,i){if(n.isEmpty(i))return first?void 0:[];var r;return n.each(t,function(n,u){for(var f in i)if(i[f]==n[f])return r=t[u],!0}),r};n.omitByKey=function(t,i){if(n.isEmpty(i))return first?void 0:[];var r=[];return n.each(t,function(n,u){var f,e,o;for(f in i)if(e=i[f],o=n[f],i[f]!=n[f])return r.push(t[u]),!0}),r};n.findAllByKey=function(t,i){var u=arguments[2]?arguments[2]:!1,r;return n.isEmpty(i)?first?void 0:[]:(r=[],n.each(t,function(n,f){for(var e in i)u,i[e]==n[e]&&r.push(t[f])}),r)};n.hasKeyVal=function(t,i){return n.where(t,i).length>0?!0:!1};n.replaceKey=function(t,i,r){return n.map(t,function(t){var u={};return n.each(t,function(n,t){t==i?u[r]=n:u[t]=n}),u})};n.replaceObjKeysByMap=function(t,i){var r=[t];return n.each(i,function(t,i){r=n.replaceKey(r,i,t)}),r[0]};n.addDisplayOrder=function(t,i){var r=[];return n.each(t,function(t,u){var f={};f[i]=u+1;r.push(n.extend(t,f))}),r};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};n.capitalizeKeys=function(t){var i=[];return n.each(t,function(t){var r={};n.each(t,function(n,t){r[t.capitalize()]=n});i.push(r)}),i};n.uniqueByKey=function(i,f){var o=u.apply(r,t.call(arguments,2)),e=[];return n.each(i,function(t){var i={};i[f]=t[f];n.hasKeyVal(e,i)||t[f]===null||(o.length>0?e.push(n.pick(t,o)):e.push(t))}),e};n.pickKeysFromObjArray=function(i){var f=[],e=u.apply(r,t.call(arguments,1));return n.each(i,function(t){f.push(n.pick(t,e))}),f};n.dedupeByKey=function(t,i){return n.each(t,function(t){console.log("OBJ1 ---->  ",t);n.each(i,function(n){console.log("obj1 key - > ",t[key]," obj2 key -> ",n[key])})}),[]};n.differenceByKey=function(t,i,r,u){var f=[],e=[];return n.each(t,function(t){var o={};o[u]=t[r];n.hasKeyVal(i,o)?f.push(t):e.push(t)}),{Matches:f,NoMatches:e}};n.groupByFilter=function(i,f){var o=u.apply(r,t.call(arguments,3)),e={};return n.each(i,function(t,i){console.log("#### group.each",t,i);console.log("XXXX group.each filter",e[t.filter]);n.isArray(e[t.filter])?(console.log("array","group[filter]",t[f],"val",t),e[t.filter].push(t)):(console.log("not array","group[filter]",t[f],"val",t),e[t.filter]=new Array(t))}),e};n.sortedGroupBy=function(t,i,r){var o=arguments[3]?arguments[3]:"_",u=n.uniqueByKey(t,i),f,e;return u=n.sortBy(u,r),f={},e={},console.log("underscore.sortedGroupby","unique",u),n.each(u,function(r){e[i]=r[i];f[o+String(r[i])]=n.findAllByKey(t,e)}),f};n.isNothing=function(t){return n.isEmpty(t)||n.isNull(t)||t===""?!0:!1};v=function(t){return this._chain?n(t).chain():t};n.mixin(n);i(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=r[t];n.prototype[t]=function(){var n=this._wrapped;return i.apply(n,arguments),(t=="shift"||t=="splice")&&n.length===0&&delete n[0],v.call(this,n)}});i(["concat","join","slice"],function(t){var i=r[t];n.prototype[t]=function(){return v.call(this,i.apply(this._wrapped,arguments))}});n.extend(n.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}});typeof define=="function"&&define.amd&&define("underscore",[],function(){return n})}.call(this);JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var s,l,h,a,v=n,c,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i));typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,c=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,s=0;s<a;s+=1)c[s]=u(s,e)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));else for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),f.lastIndex=0,f.test(n)&&(n=n.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}(),function(n){var i=window.Cookies,t=window.Cookies=n();t.noConflict=function(){return window.Cookies=i,t}}(function(){function n(){for(var n=0,r={},t,i;n<arguments.length;n++){t=arguments[n];for(i in t)r[i]=t[i]}return r}function t(i){function r(t,u,f){var o,s;if(arguments.length>1){f=n({path:"/"},r.defaults,f);typeof f.expires=="number"&&(s=new Date,s.setMilliseconds(s.getMilliseconds()+f.expires*864e5),f.expires=s);try{o=JSON.stringify(u);/^[\{\[]/.test(o)&&(u=o)}catch(y){}return u=i.write?i.write(u,t):encodeURIComponent(String(u)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",u,f.expires&&"; expires="+f.expires.toUTCString(),f.path&&"; path="+f.path,f.domain&&"; domain="+f.domain,f.secure?"; secure":""].join("")}t||(o={});for(var l=document.cookie?document.cookie.split("; "):[],a=/(%[0-9A-Z]{2})+/g,c=0;c<l.length;c++){var v=l[c].split("="),h=v[0].replace(a,decodeURIComponent),e=v.slice(1).join("=");e.charAt(0)==='"'&&(e=e.slice(1,-1));try{if(e=i.read?i.read(e,h):i(e,h)||e.replace(a,decodeURIComponent),this.json)try{e=JSON.parse(e)}catch(y){}if(t===h){o=e;break}t||(o[h]=e)}catch(y){}}return o}return r.get=r.set=r,r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,i){r(t,"",n(i,{expires:-1}))},r.withConverter=t,r}return t(function(){})}),function(){"use strict";function it(){var u=!1,n;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval");u=!0;window.localStorage.removeItem("_tmptest")}catch(f){}if(u)try{window.localStorage&&(i=window.localStorage,r="localStorage",o=i.jStorage_update)}catch(e){}else if("globalStorage"in window)try{window.globalStorage&&(i=window.location.hostname=="localhost"?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],r="globalStorage",o=i.jStorage_update)}catch(s){}else if(t=document.createElement("link"),t.addBehavior){t.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(t);try{t.load("jStorage")}catch(h){t.setAttribute("jStorage","{}");t.save("jStorage");t.load("jStorage")}n="{}";try{n=t.getAttribute("jStorage")}catch(l){}try{o=t.getAttribute("jStorage_update")}catch(a){}i.jStorage=n;r="userDataBehavior"}else{t=null;return}nt();y();rt();tt();"addEventListener"in window&&window.addEventListener("pageshow",function(n){n.persisted&&c()},!1)}function g(){var n="{}";if(r=="userDataBehavior"){t.load("jStorage");try{n=t.getAttribute("jStorage")}catch(u){}try{o=t.getAttribute("jStorage_update")}catch(f){}i.jStorage=n}nt();y();tt()}function rt(){r=="localStorage"||r=="globalStorage"?"addEventListener"in window?window.addEventListener("storage",c,!1):document.attachEvent("onstorage",c):r=="userDataBehavior"&&setInterval(c,1e3)}function c(){var n;clearTimeout(k);k=setTimeout(function(){if(r=="localStorage"||r=="globalStorage")n=i.jStorage_update;else if(r=="userDataBehavior"){t.load("jStorage");try{n=t.getAttribute("jStorage_update")}catch(u){}}n&&n!=o&&(o=n,ut())},25)}function ut(){var i=f.parse(f.stringify(n.__jstorage_meta.CRC32)),r,t,u,e;g();r=f.parse(f.stringify(n.__jstorage_meta.CRC32));u=[];e=[];for(t in i)if(i.hasOwnProperty(t)){if(!r[t]){e.push(t);continue}i[t]!=r[t]&&String(i[t]).substr(0,2)=="2."&&u.push(t)}for(t in r)r.hasOwnProperty(t)&&(i[t]||u.push(t));h(u,"updated");h(e,"deleted")}function h(n,t){var i,r,o,f,e;if(n=[].concat(n||[]),t=="flushed"){n=[];for(e in u)u.hasOwnProperty(e)&&n.push(e);t="deleted"}for(i=0,o=n.length;i<o;i++){if(u[n[i]])for(r=0,f=u[n[i]].length;r<f;r++)u[n[i]][r](n[i],t);if(u["*"])for(r=0,f=u["*"].length;r<f;r++)u["*"][r](n[i],t)}}function l(){var n=(+new Date).toString();if(r=="localStorage"||r=="globalStorage")try{i.jStorage_update=n}catch(u){r=!1}else r=="userDataBehavior"&&(t.setAttribute("jStorage_update",n),t.save("jStorage"));c()}function nt(){if(i.jStorage)try{n=f.parse(String(i.jStorage))}catch(t){i.jStorage="{}"}else i.jStorage="{}";p=i.jStorage?String(i.jStorage).length:0;n.__jstorage_meta||(n.__jstorage_meta={});n.__jstorage_meta.CRC32||(n.__jstorage_meta.CRC32={})}function a(){et();try{i.jStorage=f.stringify(n);t&&(t.setAttribute("jStorage",i.jStorage),t.save("jStorage"));p=i.jStorage?String(i.jStorage).length:0}catch(r){}}function e(n){if(typeof n!="string"&&typeof n!="number")throw new TypeError("Key name must be string or numeric");if(n=="__jstorage_meta")throw new TypeError("Reserved key name");return!0}function y(){var u,t,i,f,r=Infinity,e=!1,o=[];if(clearTimeout(d),n.__jstorage_meta&&typeof n.__jstorage_meta.TTL=="object"){u=+new Date;i=n.__jstorage_meta.TTL;f=n.__jstorage_meta.CRC32;for(t in i)i.hasOwnProperty(t)&&(i[t]<=u?(delete i[t],delete f[t],delete n[t],e=!0,o.push(t)):i[t]<r&&(r=i[t]));r!=Infinity&&(d=setTimeout(y,Math.min(r-u,2147483647)));e&&(a(),l(),h(o,"deleted"))}}function tt(){var t,f,r,u,i;if(n.__jstorage_meta.PubSub){for(u=w,i=[],t=f=n.__jstorage_meta.PubSub.length-1;t>=0;t--)r=n.__jstorage_meta.PubSub[t],r[0]>w&&(u=r[0],i.unshift(r));for(t=i.length-1;t>=0;t--)ft(i[t][1],i[t][2]);w=u}}function ft(n,t){if(s[n])for(var i=0,r=s[n].length;i<r;i++)try{s[n][i](n,f.parse(f.stringify(t)))}catch(u){}}function et(){var i,t,r;if(n.__jstorage_meta.PubSub){for(i=+new Date-2e3,t=0,r=n.__jstorage_meta.PubSub.length;t<r;t++)if(n.__jstorage_meta.PubSub[t][0]<=i){n.__jstorage_meta.PubSub.splice(t,n.__jstorage_meta.PubSub.length-t);break}n.__jstorage_meta.PubSub.length||delete n.__jstorage_meta.PubSub}}function ot(t,i){n.__jstorage_meta||(n.__jstorage_meta={});n.__jstorage_meta.PubSub||(n.__jstorage_meta.PubSub=[]);n.__jstorage_meta.PubSub.unshift([+new Date,t,i]);a();l()}function st(n,t){for(var f=n.length,i=t^f,u=0,r;f>=4;)r=n.charCodeAt(u)&255|(n.charCodeAt(++u)&255)<<8|(n.charCodeAt(++u)&255)<<16|(n.charCodeAt(++u)&255)<<24,r=(r&65535)*1540483477+(((r>>>16)*1540483477&65535)<<16),r^=r>>>24,r=(r&65535)*1540483477+(((r>>>16)*1540483477&65535)<<16),i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16)^r,f-=4,++u;switch(f){case 3:i^=(n.charCodeAt(u+2)&255)<<16;case 2:i^=(n.charCodeAt(u+1)&255)<<8;case 1:i^=n.charCodeAt(u)&255;i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16)}return i^=i>>>13,i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16),i^=i>>>15,i>>>0}var v=window.jQuery||window.$||(window.$={}),f={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(n){return String(n).evalJSON()}||v.parseJSON||v.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||v.toJSON};if(typeof f.parse!="function"||typeof f.stringify!="function")throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var n={__jstorage_meta:{CRC32:{}}},i={jStorage:"{}"},t=null,p=0,r=!1,u={},k=!1,o=0,s={},w=+new Date,d,b={isXML:function(n){var t=(n?n.ownerDocument||n:0).documentElement;return t?t.nodeName!=="HTML":!1},encode:function(n){if(!this.isXML(n))return!1;try{return(new XMLSerializer).serializeToString(n)}catch(t){try{return n.xml}catch(i){}}return!1},decode:function(n){var i="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(n){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(n),t},t;return i?(t=i.call("DOMParser"in window&&new DOMParser||window,n,"text/xml"),this.isXML(t)?t:!1):!1}};v.jStorage={version:"0.4.12",set:function(t,i,r){if(e(t),r=r||{},typeof i=="undefined")return this.deleteKey(t),i;if(b.isXML(i))i={_is_xml:!0,xml:b.encode(i)};else{if(typeof i=="function")return undefined;i&&typeof i=="object"&&(i=f.parse(f.stringify(i)))}return n[t]=i,n.__jstorage_meta.CRC32[t]="2."+st(f.stringify(i),2538058380),this.setTTL(t,r.TTL||0),h(t,"updated"),i},get:function(t,i){return(e(t),t in n)?n[t]&&typeof n[t]=="object"&&n[t]._is_xml?b.decode(n[t].xml):n[t]:typeof i=="undefined"?null:i},deleteKey:function(t){return(e(t),t in n)?(delete n[t],typeof n.__jstorage_meta.TTL=="object"&&t in n.__jstorage_meta.TTL&&delete n.__jstorage_meta.TTL[t],delete n.__jstorage_meta.CRC32[t],a(),l(),h(t,"deleted"),!0):!1},setTTL:function(t,i){var r=+new Date;return(e(t),i=Number(i)||0,t in n)?(n.__jstorage_meta.TTL||(n.__jstorage_meta.TTL={}),i>0?n.__jstorage_meta.TTL[t]=r+i:delete n.__jstorage_meta.TTL[t],a(),y(),l(),!0):!1},getTTL:function(t){var r=+new Date,i;return(e(t),t in n&&n.__jstorage_meta.TTL&&n.__jstorage_meta.TTL[t])?(i=n.__jstorage_meta.TTL[t]-r,i||0):0},flush:function(){return n={__jstorage_meta:{CRC32:{}}},a(),l(),h(null,"flushed"),!0},storageObj:function(){function t(){}return t.prototype=n,new t},index:function(){var i=[];for(var t in n)n.hasOwnProperty(t)&&t!="__jstorage_meta"&&i.push(t);return i},storageSize:function(){return p},currentBackend:function(){return r},storageAvailable:function(){return!!r},listenKeyChange:function(n,t){e(n);u[n]||(u[n]=[]);u[n].push(t)},stopListening:function(n,t){if(e(n),u[n]){if(!t){delete u[n];return}for(var i=u[n].length-1;i>=0;i--)u[n][i]==t&&u[n].splice(i,1)}},subscribe:function(n,t){if(n=(n||"").toString(),!n)throw new TypeError("Channel not defined");s[n]||(s[n]=[]);s[n].push(t)},publish:function(n,t){if(n=(n||"").toString(),!n)throw new TypeError("Channel not defined");ot(n,t)},reInit:function(){g()},noConflict:function(n){return delete window.$.jStorage,n&&(window.jStorage=this),this}};it()}();!function(n){n.fn.viewportChecker=function(t){var i={classToAdd:"visible",classToRemove:"invisible",classToAddForFullView:"full-visible",removeClassAfterAnimation:!1,offset:100,repeat:!1,invertBottomOffset:!0,callbackFunctionBeforeAddClass:function(){},callbackFunction:function(){},scrollHorizontal:!1,scrollBox:window};n.extend(i,t);var u=this,r={height:n(i.scrollBox).height(),width:n(i.scrollBox).width()},f=-1!=navigator.userAgent.toLowerCase().indexOf("webkit")||-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")?"body":"html";return this.checkElements=function(){var t,e;i.scrollHorizontal?(t=n(f).scrollLeft(),e=t+r.width):(t=n(f).scrollTop(),e=t+r.height);u.each(function(){var u=n(this),f={},o={};if(u.data("vp-add-class")&&(o.classToAdd=u.data("vp-add-class")),u.data("vp-remove-class")&&(o.classToRemove=u.data("vp-remove-class")),u.data("vp-add-class-full-view")&&(o.classToAddForFullView=u.data("vp-add-class-full-view")),u.data("vp-keep-add-class")&&(o.removeClassAfterAnimation=u.data("vp-remove-after-animation")),u.data("vp-offset")&&(o.offset=u.data("vp-offset")),u.data("vp-repeat")&&(o.repeat=u.data("vp-repeat")),u.data("vp-scrollHorizontal")&&(o.scrollHorizontal=u.data("vp-scrollHorizontal")),u.data("vp-invertBottomOffset")&&(o.scrollHorizontal=u.data("vp-invertBottomOffset")),n.extend(f,i),n.extend(f,o),!u.data("vp-animated")||f.repeat){String(f.offset).indexOf("%")>0&&(f.offset=parseInt(f.offset)/100*r.height);var s=f.scrollHorizontal?u.offset().left:u.offset().top,l=f.scrollHorizontal?s+u.width():s+u.height(),h=Math.round(s)+f.offset,c=f.scrollHorizontal?h+u.width():h+u.height();f.invertBottomOffset&&(c-=2*f.offset);e>h&&c>t?(f.callbackFunctionBeforeAddClass(u),u.removeClass(f.classToRemove),u.addClass(f.classToAdd),f.callbackFunction(u,"add"),e>=l&&s>=t?u.addClass(f.classToAddForFullView):u.removeClass(f.classToAddForFullView),u.data("vp-animated",!0),f.removeClassAfterAnimation&&u.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){u.removeClass(f.classToAdd)})):u.hasClass(f.classToAdd)&&f.repeat&&(u.removeClass(f.classToAdd+" "+f.classToAddForFullView),f.callbackFunction(u,"remove"),u.data("vp-animated",!1))}})},("ontouchstart"in window||"onmsgesturechange"in window)&&n(document).bind("touchmove MSPointerMove pointermove",this.checkElements),n(i.scrollBox).bind("load scroll",this.checkElements),n(window).resize(function(){r={height:n(i.scrollBox).height(),width:n(i.scrollBox).width()};u.checkElements()}),this.checkElements(),this}}(jQuery),function(n){n.fn.jalert=function(t){var i=this,f=n('<div class="alert alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—<\/span><\/button><span><\/span><\/div>'),e=n.extend({},{type:"success",useTitles:!1},t),r=function(n){f.find("> span").html(n);i.append(f)},u=function(n){var t=n=="error"?"danger":n;f.addClass("alert-"+t)};return this.error=function(n){return r(n),u("error"),i},this.success=function(n){return r(n),u("success"),i},this.info=function(n){return r(n),u("info"),i},this.warning=function(n){return r(n),u("warning"),i},this.hide=function(n){return i.slideUp(n),i},this.show=function(){return i.css("display","none"),i.removeClass("hide fade"),i.slideDown(),i},this.autohide=function(n){setTimeout(function(){i.slideUp()},n?n:5e3)},this}}(jQuery),function(n){n.fn.loader=function(t){var r=this,u=n.extend({},{location:"in",img:'<img src="https://s3.amazonaws.com/mg2.paywall.dev/img/ajax-loading.gif" style="margin: 0 5px" />',loaderId:"loader"},t),f=n(u.img).prop("id",u.loaderId),e,i;return this.on=function(){try{i=r.children("span").length?r.children("span"):r;e=i.html();u.location=="in"&&i.html(f)}catch(n){console.log(n)}},this.off=function(){try{i.html(e);f.remove()}catch(n){}},this}}(jQuery);var ConnextLogger=function(n){var i=!0,t=function(){var i;try{var r=Array.prototype.slice.call(arguments[2]),u=arguments[0],e=arguments[1],o=r.length,f=[],t=[];o>0&&n.each(r,function(n,i){typeof i=="string"?f.push(i):t.push(i)});i=e+f.join(" => ");t.length>0?console[u](i,t):console[u](i)}catch(s){}};return{debug:function(){var n=arguments;i&&t("log","Connext >>>> DEBUG <<<<< ",n)},log:function(){t("log","Connext >>>> LOG <<<<< ",arguments)},info:function(){t("info","Connext >>>> INFO <<<<< ",arguments)},warn:function(){t("warn","Connext >>>> WARN <<<<< ",arguments)},error:function(){t("exception","MG2Connext >>>> ERROR <<<<< ",arguments)},exception:function(){t("error","MG2Connext >>>> EXCEPTION <<<<< ",arguments)},setDebug:function(n){i=n}}},ConnextCommon=function(){return{S3RootUrl:{dev:"https://s3.amazonaws.com/connext.dev/",test:"https://s3.amazonaws.com/connext.test/",prod:"https://s3.amazonaws.com/connext.prod/",stage:"https://s3.amazonaws.com/connext.stage/",prod:"https://s3.amazonaws.com/connext.prod/"},S3LastPublishDatePath:"data/last_publish/<%= siteCode %>.json",CSSPluginUrl:{localhost:"http://localhost:20001/plugin/assets/css/themes/",dev:"https://mg2assetsdev.blob.core.windows.net/connext/dev/1.3/themes/",test:"https://mg2assetsdev.blob.core.windows.net/connext/test/1.3/themes/",stage:"https://mg2assetsdev.blob.core.windows.net/connext/stage/1.3/themes/",demo:"https://mg2assetsdev.blob.core.windows.net/connext/demo/1.3/themes/",prod:"https://cdn.mg2connext.com/prod/1.3/themes/"},APIUrl:{localhost:"http://localhost:34550/",dev:"https://dev-connext-api.azurewebsites.net/",test:"https://test-connext-api.azurewebsites.net/",stage:"https://stage-connext-api.azurewebsites.net/",demo:"https://demo-connext-api.azurewebsites.net/",prod:"https://api.mg2connext.com/"},Environments:["localhost","dev","test","stage","demo","prod"],IPInfo:window.location.protocol+"//freegeoip.net/json/",StorageKeys:{configuration:"Connext_Configuration",userToken:"Connext_UserToken",janrainUserProfile:"janrainCaptureProfileData",accessToken:"Connext_AccessToken",viewedArticles:"Connext_ViewedArticles",lastPublishDate:"Connext_LastPublishDate",conversations:{current:"Connext_CurrentConversations",previous:"Connext_PreviousConversations"},user:{state:"Connext_UserState",zipCodes:"Connext_UserZipCodes"},configurationSiteCode:"Connext_Configuration_SiteCode",configurationConfigCode:"Connext_Configuration_ConfigCode",configurationIsCustom:"Connext_Configuration_isCustom",customZip:"CustomZip",repeatablesInConv:"repeatablesInConv"},MeterLevels:{1:"Free",2:"Metered",3:"Premium"},ConversationOptionMap:{2:"Time",6:"Register",11:"CustomAction",27:"UserState"},ActionOptionMap:{Who:[11,12,5,6,14,16,17,18,19,20,21],What:[2,7,13,20,15,22],When:[8,9,10]},WhenClassMap:{8:"Time",9:"EOS",10:"Hover"},DefaultArticleFormat:"MMM Do, YYYY",QualifierMap:{"==":"==","=":"==",Equal:"==",Equals:"==","Not Equals":"!="},ERROR:{NO_CONFIG:{code:600,message:"No Configuration Found"},NO_CONVO_FOUND:{code:601,message:"No Conversation found to process."}}}},ConnextEvents=function(n){function r(t){var r="onCriticalError";try{e.push(t);n("#ddNote").html(t)}catch(u){console.error(i,r,"EXCEPTION",u)}}function s(n){var r="onInit";try{t.debug("Fire Default onInit function.",n)}catch(n){console.error(i,r,"EXCEPTION",n)}}function h(n){var r="onFlittzButtonClick";try{t.debug("Click on Flittz button",n)}catch(n){console.error(i,r,"EXCEPTION",n)}}function c(r){var u="onCriticalError";try{t.debug("Fire Default onCriticalError function.",r);e.push(r.message);n("#ddNote").html(r.message)}catch(r){console.error(i,u,"EXCEPTION",r)}}function l(r){var u="onMeterLevelSet";try{t.debug("Fire Default onMeterLevelSet function.",r);n("#ddMeterLevel").html(Connext.Common.MeterLevels[r.level]+" ("+r.method+")")}catch(r){console.error(i,u,"EXCEPTION",r)}}function a(n){var u="onHasAccessToken";try{t.debug("Fire Default onHasAccessToken function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function v(n){var u="onHasAccess";try{t.debug("Fire Default onHasAccess function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function y(n){var u="onHasUserToken";try{t.debug("Fire Default onHasUserToken function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function p(n){var u="onUserTokenSuccess";try{t.debug("Fire Default onUserTokenSuccess function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function w(n){var u="onAuthorized";try{t.debug("Fire Default onAuthorized function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function b(n){var u="onNotAuthorized";try{t.debug("Fire Default onNotAuthorized function.",n);r(n)}catch(n){console.error(i,u,"EXCEPTION",n)}}function k(r){var u="onCampaignFound";try{t.debug("Fire Default onCampaignFound function.",r);n("#ddCampaign").html(r.Name)}catch(r){console.error(i,u,"EXCEPTION",r)}}function d(r){var u="onConversationDetermined";try{t.debug("Fire Default onConversationDetermined function.",r);n("#ddCurrentConversation").html(r.Name);n.jStorage.get("uniqueArticles")?n("#ddCurrentConversationArticleViews").html(Connext.Storage.GetViewedArticles(r.id).length):n("#ddCurrentConversationArticleViews").html(r.Props.views)}catch(r){console.error(i,u,"EXCEPTION",r)}}function g(n){var i="onActionShown";try{t.debug("Fire Default onActionShown",n);Connext.Action.actionStartTime=Date.now()}catch(r){console.error(Name,i,"EXCEPTION",r)}}function nt(i){var u="onActionClosed",r;try{t.debug("Fire Default onActionClosed",i);Connext.Action.actionEndTime=Date.now();r=Connext.Action.actionEndTime-Connext.Action.actionStartTime;n("#ddViewTime")[0].textContent=r+"ms"}catch(f){console.error(Name,u,"EXCEPTION",f)}}function tt(n){var i="onButtonClick";try{t.debug("Fire Default onButtonClick",n)}catch(r){console.error(Name,i,"EXCEPTION",r)}}var i="Events",u,t,f={onMeterLevelSet:l,onCampaignFound:k,onConversationDetermined:d,onHasAccessToken:a,onHasAccess:v,onCriticalError:c,onHasUserToken:y,onUserTokenSuccess:p,onAuthorized:w,onNotAuthorized:b,onDebugNote:r,onActionShown:g,onActionClosed:nt,onFlittzButtonClick:h,onInit:s,onButtonClick:tt},e=[],o=function(){var n="Init";try{t.debug(i,n,"Initializing Events...")}catch(r){console.error(i,n,r)}};return{init:function(n){t=Connext.Logger;u=n?n:{debug:!0};o()},fire:function(n,t){try{u.debug&&_.isFunction(f[n])&&f[n](t);_.isFunction(u[n])&&u[n](t)}catch(r){console.error(i,"on","EXCEPTION",r)}}}},ConnextUtils=function(n){var t="Utils",i,r=function(n){var e="processConfiguration",r;try{return i.debug(t,e,"starting to process..."),r={},r.Settings=_.pick(n,"AccessRules","Active","Code","DefaultMeterLevel","CampaignId","DynamicMeterId","Name","LastPublishDate"),r.Settings=u(r.Settings),r.Settings.LoginModal=n.Template?n.Template.Html:"",r.Site=n.Site,r.Campaign=f(n.Campaign),n.DynamicMeter.Rules=_.sortBy(n.DynamicMeter.Rules,function(n){return n.Priority}),r.DynamicMeter=l(n.DynamicMeter),i.debug(t,e,"done processing configuration",r),r}catch(o){console.log(t,e,"EXCEPTION",o)}},u=function(n){var r="checkForLastPublishDate";try{return n.LastPublishDate||(i.warn(t,r,"Configuration.Settings.LastPublishDate is null...setting it to todays datetime."),n.LastPublishDate=(new Date).format()),n}catch(u){return console.error(t,r,"EXCEPTION",u),n}},f=function(n){var u="processCampaignData",r;try{return i.debug(t,u),r=_.pick(n,"id","Name","Conversations"),r.Conversations=e(r.Conversations),i.debug(t,u,"processedCampaign",r),r}catch(f){console.log(pName,u,"EXCEPTION",f)}},e=function(r){var u="processConversationData",f,e;try{return i.debug(t,u,"conversations",r),f={views:0,paywallLimit:null,isExpired:!1,expiredReason:null,Date:{started:null,ended:null,expiration:null}},n.each(r,function(r,e){i.debug(t,u,"conversations.EACH",r,e);var h=_.groupBy(e.Options,function(n){return n.ConversationOption.ParentConversationOptionId}),s={};n.each(h,function(t,i){console.info("GROUPEDOPTIONS.EACH",t,i);var r={};n.each(i,function(n,t){r[t.ConversationOption.DisplayName]=t.Value});s[Connext.Common.ConversationOptionMap[t]]=r});e.Options={Expirations:s};e.Props=f;e.Actions=o(e.Actions)}),e=_.groupBy(r,"MeterLevelId"),_.replaceObjKeysByMap(e,Connext.Common.MeterLevels)}catch(s){console.error(t,u,"EXCEPTION",s)}},o=function(i){var r="processConversationActions";try{return n.each(i,function(n,t){var r=_.filter(t.ActionOptionValues,function(n){return _.contains(Connext.Common.ActionOptionMap.Who,n.ActionOption.Action_OptionClass.id)}),u=_.filter(t.ActionOptionValues,function(n){return _.contains(Connext.Common.ActionOptionMap.What,n.ActionOption.Action_OptionClass.id)}),f=_.filter(t.ActionOptionValues,function(n){return _.contains(Connext.Common.ActionOptionMap.When,n.ActionOption.Action_OptionClass.id)});t.Who=s(r);t.What=h(u);t.When=c(f);i[n]=_.omit(t,"ActionOptionValues")}),_.sortBy(i,"Order")}catch(u){console.error(t,r,"EXCEPTION",u)}},s=function(i){var f="processWhoOptions",u,r;try{return u=_.groupBy(i,function(n){return n.ActionOption.ActionOptionParentId}),r={},n.each(u,function(t,i){var e=t,f,u;e==2?(f=_.groupBy(i,function(n){return n.ActionOption.Action_OptionClass.id}),r.Views=[],n.each(f,function(n,t){var i={};i[t[0].ActionOption.DisplayName]=t[0].Value;i[t[1].ActionOption.DisplayName]=t[1].Value;r.Views.push(i)})):(u={},n.each(i,function(n,t){u[t.ActionOption.DisplayName]=t.Value}),r[i[0].ActionOption.Action_OptionClass.Name]=u)}),r}catch(e){console.error(t,f,"EXCEPTION",e)}},h=function(i){var u="processWhatOptions",r;try{return r={},n.each(i,function(n,t){r[t.ActionOption.DisplayName]=t.Value}),r}catch(f){console.error(t,u,"EXCEPTION",f)}},c=function(i){var f="processWhenOptions",r,u;try{return r={},u={},n.each(i,function(n,t){u[t.ActionOption.DisplayName]=t.Value}),r[Connext.Common.WhenClassMap[i[0].ActionOption.Action_OptionClass.id]]=u,r}catch(e){console.error(t,f,"EXCEPTION",e)}},l=function(r){var u="processDynamicMeter";try{return i.debug(t,u,r),n.each(r.Rules,function(t,i){n.each(i.Segments,function(t,r){var f=_.find(r.SegmentOptionValues,function(n){return n.SegmentOption.ClassId!=null}).SegmentOption.Segment_OptionClass.Name,u={};n.each(r.SegmentOptionValues,function(n,t){u[t.SegmentOption.DisplayName]=t.Value});r.Options=u;r.SegmentType=f;i.Segments[t]=_.omit(r,"SegmentOptionValues")})}),r}catch(f){console.error(t,u,"EXCEPTION",f)}},a=function(r){var u="mergeConfiguration",e,f;try{i.debug(t,u,"newConfig",r);Connext.Storage.SetLocalConfiguration(r);e=Connext.Storage.GetCurrentConversations();i.debug(t,u,"CurrentConversations",e);f={};n.each(e,function(e,o){i.debug(t,u,"currentConversations.EACH",e,o);var s=_.findByKey(r.Campaign.Conversations[e],{id:o.id});i.debug(t,u,"currentConversations.EACH","foundStoredConvo",s);s&&(f[e]=n.extend({},s),f[e].Props=o.Props)});Connext.Storage.SetCurrentConversations(f)}catch(o){console.error(t,u,"EXCEPTION",o)}},v=function(){var i=n("#ConnextSiteCode").val(),r=n("#ConnextConfigCode").val(),t=n("#ConnextCustomConfiguration").prop("checked");t&&(Connext.Storage.ClearConfigSettings(),Connext.Storage.SetSiteCode(i),Connext.Storage.SetConfigCode(r),Connext.Storage.SetIsCustomConfiguration(t))},y=function(){var r="handleDebugDetails",i;try{try{i='<div class="debug_details opened" style="left: 0;"><div class="debug_details_icon">&nbsp;<\/div><div class="debug_details_content"><h4>Debug Details<\/h4><ul><li class="debug_details_header hide_on_mobile"><label>Meter Level: <strong id="ddMeterLevel">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><label>Campaign: <strong id="ddCampaign">...<\/strong><\/label><label>Conversation: <strong id="ddCurrentConversation">...<\/strong><\/label><label>Article Views: <strong id="ddCurrentConversationArticleViews">...<\/strong><\/label><label>Articles Left: <strong id="ddCurrentConversationArticleLeft">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><label>View Time: <strong id="ddViewTime">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><label>Current Zip: <strong id="ddZipCode">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><label>Auth Time: <strong id="ddAuthTime">...<\/strong><\/label><label>Processing Time: <strong id="ddProcessingTime">...<\/strong><\/label><label>Total Time: <strong id="ddTotalProcessingTime">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><label>Note: <strong id="ddNote">...<\/strong><\/label><\/li><li class="debug_details_header hide_on_mobile"><div id="ConnextCustomConfigurationDiv"><label for="ConnextSiteCode">Site code: <\/label><input type="text" id="ConnextSiteCode"><label for="ConnextConfigCode">Config code: <\/label><input type="text" id="ConnextConfigCode"><a href="#" class="more highlight margin_top_15" id="ConnextSetCustomConfiguration">Set configuration<\/a><\/div><label class="overlay_label check" for="ConnextCustomConfiguration">Use custom configuration: <\/label> <input type="checkbox" id="ConnextCustomConfiguration"><label class="overlay_label check" for="ConnextCustomConfiguration">Unique Articles Count: <\/label> <input type="checkbox" id="uniqueArticles"><\/li><li class="debug_details_header hide_on_mobile"><label for="ConnextCustomTimeChk" class="overlay_label check">Custom Time: <\/label> <input type="checkbox" id="ConnextCustomTimeChk"><div id="ConnextCustomTimeDiv"><input type="text" id="ConnextCustomTimeTxt" placeholder="MM/DD/YYYY" value="" name="name" class="text_input hint"><a href="#" class="more highlight margin_top_15" id="ConnextSetCustomTimeBtn">Set<\/a><\/div><\/li><li class="debug_details_header hide_on_mobile"><a href="#" class="more highlight margin_top_15" id="connextClearAllData">Clear All Data<\/a><\/li><\/ul><\/div><\/div>';n("body").append(i);n("#ConnextSetCustomConfiguration").on("click",v);n(".debug_details_icon").on("click",p);n("#connextClearAllData").on("click",w);k();b();Connext.Storage.GetUserZipCodes()?n("#ddZipCode").html(Connext.Storage.GetUserZipCodes().toString()):n("#ddZipCode").html(n.jStorage.get("CustomZip"));n.jStorage.get("uniqueArticles")&&n("#uniqueArticles").attr("checked","checked");n("#ConnextCustomConfiguration").on("change",function(){var t=n(this);t.prop("checked")?n("#ConnextCustomConfigurationDiv").show():(n("#ConnextCustomConfigurationDiv").hide(),Connext.Storage.SetIsCustomConfiguration(!1))});n("#ConnextCustomTimeChk").on("change",function(){var t=n(this);t.prop("checked")?n("#ConnextCustomTimeDiv").show():(n("#ConnextCustomTimeDiv").hide(),n.jStorage.deleteKey("CustomTime"))});n("#uniqueArticles").on("change",function(){var t=n(this);n.jStorage.set("uniqueArticles",t.prop("checked"))});n("#ConnextSetCustomTimeBtn").on("click",function(t){t.preventDefault();n.jStorage.set("CustomTime",n("#ConnextCustomTimeTxt").val())})}catch(f){console.error(pName,"CreateDebugDetailPanel")}}catch(u){console.error(t,r,"EXCEPTION",u)}},p=function(i){var u="handleDebugDetailsDisplayClick",r;try{i.preventDefault();r=n(this).parent("div");r.toggleClass("opened")}catch(i){console.error(t,u,"EXCEPTION",i)}},w=function(n){var r="clearAllSettings";try{n.preventDefault();i.debug(t,r,"clearAllSettings");Connext.Storage.ClearConfigSettings()}catch(n){console.error(t,r,"EXCEPTION",n)}},b=function(){Connext.Storage.GetIsCustomConfiguration()?n("#ConnextCustomConfigurationDiv").show():n("#ConnextCustomConfigurationDiv").hide()},k=function(){var i="handleCustomTime";try{n.jStorage.get("CustomTime")?(n("#ConnextCustomTimeChk").prop("checked",!0),n("#ConnextCustomTimeTxt").val(n.jStorage.get("CustomTime")),n("#ConnextCustomTimeDiv").show()):(n("#ConnextCustomTimeChk").prop("checked",!1),n("#ConnextCustomTimeDiv").hide(),n("#ConnextCustomTimeTxt").val(new Date))}catch(r){console.error(t,i,"EXCEPTION",r)}};return{init:function(){i=Connext.Logger},Now:function(){try{return n.jStorage.get("CustomTime")?new Date(Date.parse(n.jStorage.get("CustomTime"))):new Date}catch(i){console.error(t,"Now",i)}},ProcessConfiguration:function(n){return r(n)},MergeConfiguration:function(n){a(n)},CreateDebugDetailPanel:function(){y()},GetUrlParam:function(n){for(var u=window.location.search.substring(1),i,r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return unescape(i[1]);return null},ParseCustomDate:function(n,t){if(t=t||"dd.mm.yyyy",!n)return new Date;var r=n.match(/(\d+)/g),u=0,i={};return t.replace(/(yyyy|dd|mm)/g,function(n){i[n]=u++}),new Date(r[i.yyyy],r[i.mm]-1,r[i.dd])},GetUrl:function(){return location.protocol+"//"+location.host+location.pathname},GetHiddenFormFieldValue:function(r){try{var u=n("#"+r).val();return i.debug(t,"GetHiddenFormFieldValue","hidValue",u),u}catch(f){return console.error(t,"GetHiddenFormFieldValue",f),""}},JSEvaluate:function(n,r,u){try{var o=arguments[3]?arguments[3]+" ---- ":"",s=arguments[4]?arguments[4]:"string",e=Connext.Utils.FixQualifier(r),f=s=="string"?"'"+n+"'"+e+"'"+u+"'":""+n+""+e+""+u+"";return eval(f)?(i.debug(t,"JSEvalute --- <<<<< "+f," >>>>> ---- PASSES"),!0):(i.debug(t,o+"JSEvalute --- <<<<< "+f," >>>>> ---- FAILS"),!1)}catch(h){return console.error(t,"JSEvaluate",h),!1}},FixQualifier:function(n){try{var i=Connext.Common.QualifierMap[n];return i?i:n}catch(r){return console.error(t,fnName,"EXCEPTION",r),n}},getFileName:function(){var n=arguments[0]?arguments[0]:window.location.href;return n.substring(n.lastIndexOf("/")+1)},getCurPageName:function(){return location.pathname.substring(1)},getParam:function(n){for(var u=window.location.search.substring(1),i,r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return unescape(i[1]);return null},hasParam:function(n){for(var f=window.location.search.substring(1),i,u=f.split("&"),r,t=0;t<u.length;t++)if(i=u[t].split("="),i[0]==n)return r=unescape(i[1]),r.length>0&&typeof r=="string"?!0:!1;return!1},GetUserZipcode:function(){return i.debug(t,"Utils.GetUserZipcode","CustomZip"),n.jStorage.get("CustomZip")},EncryptAccessToken:function(){for(var n,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",r=0;r<64;r++)n=Math.floor(Math.random()*t.length),i+=t.substring(n,n+1);return i},DecryptAccessToken:function(){return!0},getScreenSize:function(){var t=n(window).width();return window.screen&&(t=window.screen.width),t},getDeviceType:function(){var n,t,i;return(n={},i=window.navigator.userAgent.toLowerCase(),n.ios=function(){return n.iphone()||n.ipod()||n.ipad()},n.iphone=function(){return!n.windows()&&t("iphone")},n.ipod=function(){return t("ipod")},n.ipad=function(){return t("ipad")},n.android=function(){return!n.windows()&&t("android")},n.androidPhone=function(){return n.android()&&t("mobile")},n.androidTablet=function(){return n.android()&&!t("mobile")},n.blackberry=function(){return t("blackberry")||t("bb10")||t("rim")},n.blackberryPhone=function(){return n.blackberry()&&!t("tablet")},n.blackberryTablet=function(){return n.blackberry()&&t("tablet")},n.windows=function(){return t("windows")},n.windowsPhone=function(){return n.windows()&&t("phone")},n.windowsTablet=function(){return n.windows()&&t("touch")&&!n.windowsPhone()},n.fxos=function(){return(t("(mobile;")||t("(tablet;"))&&t("; rv:")},n.fxosPhone=function(){return n.fxos()&&t("mobile")},n.fxosTablet=function(){return n.fxos()&&t("tablet")},n.meego=function(){return t("meego")},n.cordova=function(){return window.cordova&&location.protocol==="file:"},n.nodeWebkit=function(){return typeof process=="object"},n.mobile=function(){return n.androidPhone()||n.iphone()||n.ipod()||n.windowsPhone()||n.blackberryPhone()||n.fxosPhone()||n.meego()},n.tablet=function(){return n.ipad()||n.androidTablet()||n.blackberryTablet()||n.windowsTablet()||n.fxosTablet()},n.desktop=function(){return!n.tablet()&&!n.mobile()},t=function(n){return i.indexOf(n)!==-1},n.mobile())?"Mobile":n.tablet()?"Tablet":n.desktop()?"Desktop":void 0},getUrlParam:function(n){var t="",i=document.location.search.substr(1),r=i.split("&");return r.every(function(i){var r=i.split("=");return r[0]==n?(t=r[1],!1):!0}),t},getSubdomains:function(){var n=document.location.origin.split("."),t;return n.pop(),n.pop(),n.length&&(t=n[0].substring(n[0].lastIndexOf("/")+1),t==="www"?n.shift():n[0]=t),n},getMetaTagsWithKeywords:function(){return n("meta[name=keywords]")}}},ConnextStorage=function(n){var t="STORAGE",i,s=function(r){var u="getLocalStorage";try{return i.debug(t,u),n.jStorage.get(Connext.Common.StorageKeys[r])}catch(f){console.log(t,u,"EXCEPTION",f)}},h=function(r,u){var f="setLocalStorage";try{return i.debug(t,f),n.jStorage.set(Connext.Common.StorageKeys[r],u)}catch(e){console.log(pName,f,"EXCEPTION",e)}},a=function(r){var u="deleteLocalStorage";try{return i.debug(t,u),n.jStorage.deleteKey(Connext.Common.StorageKeys[r])}catch(f){console.log(pName,u,"EXCEPTION",f)}},r=function(n){var r="getCookie";try{return i.debug(t,r,n,"Connext.Common.StorageKeys[key]",Connext.Common.StorageKeys[n]),Cookies.get(Connext.Common.StorageKeys[n])}catch(u){console.log(t,r,"EXCEPTION",u)}},u=[],e=[],o=function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return null},v=function(n,t){setInterval(function(){if(u[n]){if(o(n)!=u[n])return u[n]=o(n),t()}else u[n]=o(n)},1e3)},c=function(n,t){e[n]=localStorage.getItem(n);setInterval(function(){if(localStorage.getItem(n)!=e[n])return e[n]=localStorage.getItem(n),t()},1e3)},l=function(){c("janrainCaptureToken",function(){Connext.Storage.SetUserState(null);Connext.Storage.SetUserZipCodes(null);Connext.Run()})},f=function(n,r){var u="setCookie";try{return i.debug(t,u),arguments[2]?(i.debug(t,u,"HasExpiration","key",n,"expiration",arguments[2]),Cookies.set(Connext.Common.StorageKeys[n],r,{expires:arguments[2]})):Cookies.set(Connext.Common.StorageKeys[n],r)}catch(f){console.log(t,u,"EXCEPTION",f)}};return{init:function(){i=Connext.Logger;i.debug(t,"Init");l()},GetLocalConfiguration:function(){return s("configuration")},SetLocalConfiguration:function(n){return h("configuration",n)},GetUserState:function(){return n.jStorage.get(Connext.Common.StorageKeys.user.state)},SetUserState:function(t){return n.jStorage.set(Connext.Common.StorageKeys.user.state,t)},GetUserZipCodes:function(){return n.jStorage.get(Connext.Common.StorageKeys.user.zipCodes)},SetUserZipCodes:function(t){return n.jStorage.set(Connext.Common.StorageKeys.user.zipCodes,t)},GetLastPublishDate:function(){return r("lastPublishDate")},SetLastPublishDate:function(n,t){return f("lastPublishDate",n,t)},GetCurrentConversations:function(){var t=n.jStorage.get(Connext.Common.StorageKeys.conversations.current);return t?t:{}},SetCurrentConversations:function(t){return n.jStorage.set(Connext.Common.StorageKeys.conversations.current,t)},GetCampaignData:function(){return n.jStorage.get(Connext.Common.StorageKeys.configuration).Campaign},GetViewedArticles:function(t){return n.jStorage.get(Connext.Common.StorageKeys.viewedArticles)?n.jStorage.get(Connext.Common.StorageKeys.viewedArticles)[t]:[]},UpdateViewedArticles:function(t){var i=Connext.Storage.GetViewedArticles(t),r;i==undefined&&(i=[]);i.push(Connext.Utils.GetUrl());r=n.jStorage.get(Connext.Common.StorageKeys.viewedArticles)?n.jStorage.get(Connext.Common.StorageKeys.viewedArticles):{conversationId:i};r[t]=i;console.warn("new array",i);n.jStorage.set(Connext.Common.StorageKeys.viewedArticles,r)},GetRepeatablesInConv:function(t){n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv)||n.jStorage.set(Connext.Common.StorageKeys.repeatablesInConv,{});var i=n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv);return n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv)[t]||(i[t]=0,n.jStorage.set(Connext.Common.StorageKeys.repeatablesInConv,i)),n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv)[t]},UpdateRepeatablesInConv:function(t){n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv)||n.jStorage.set(Connext.Common.StorageKeys.repeatablesInConv,{});var i=n.jStorage.get(Connext.Common.StorageKeys.repeatablesInConv);i[t]=i[t]+1;n.jStorage.set(Connext.Common.StorageKeys.repeatablesInConv,i)},ClearConfigSettings:function(){n.jStorage.deleteKey(Connext.Common.StorageKeys.conversations.current);n.jStorage.deleteKey(Connext.Common.StorageKeys.conversations.previous);n.jStorage.deleteKey(Connext.Common.StorageKeys.viewedArticles);n.jStorage.deleteKey(Connext.Common.StorageKeys.configuration);n.jStorage.deleteKey(Connext.Common.StorageKeys.configurationSiteCode);n.jStorage.deleteKey(Connext.Common.StorageKeys.configurationConfigCode);n.jStorage.deleteKey(Connext.Common.StorageKeys.configurationIsCustom);n.jStorage.deleteKey(Connext.Common.StorageKeys.user.state);n.jStorage.deleteKey(Connext.Common.StorageKeys.user.zipCodes);n.jStorage.deleteKey(Connext.Common.StorageKeys.customZip);n.jStorage.deleteKey(Connext.Common.StorageKeys.repeatablesInConv);Cookies.remove(Connext.Common.StorageKeys.lastPublishDate);Cookies.remove(Connext.Common.StorageKeys.userToken)},ClearUser:function(){Cookies.remove(Connext.Common.StorageKeys.userToken);Cookies.remove(Connext.Common.StorageKeys.accessToken);Cookies.remove("userToken");Cookies.remove("userMasterId");localStorage.removeItem("janrainCaptureProfileData");localStorage.removeItem("janrainCaptureReturnExperienceData");n.jStorage.deleteKey(Connext.Common.StorageKeys.user.zipCodes)},SetAccessToken:function(n){return f("accessToken",n)},GetAccessToken:function(){return i.debug(t,"GetAccessToken",Connext.Common.StorageKeys.accessToken),r("accessToken")},SetUserToken:function(n){return f("userToken",n,365)},GetUserToken:function(){return r("userToken")},SetUserRegId:function(n){return f("userMasterId",n,365)},GetUserRegId:function(){return r("userMasterId")},GetJanrainUser:function(){return localStorage.getItem(Connext.Common.StorageKeys.janrainUserProfile)},SetSiteCode:function(t){n.jStorage.set(Connext.Common.StorageKeys.configurationSiteCode,t)},GetSiteCode:function(){return n.jStorage.get(Connext.Common.StorageKeys.configurationSiteCode)},SetConfigCode:function(t){n.jStorage.set(Connext.Common.StorageKeys.configurationConfigCode,t)},GetConfigCode:function(){return n.jStorage.get(Connext.Common.StorageKeys.configurationConfigCode)},SetIsCustomConfiguration:function(t){n.jStorage.set(Connext.Common.StorageKeys.configurationIsCustom,t)},GetIsCustomConfiguration:function(){return n.jStorage.get(Connext.Common.StorageKeys.configurationIsCustom)}}},ConnextAPI=function(n){var i="API",t,r,f,e="api/",o={GetConfiguration:_.template("configuration/siteCode/<%= siteCode %>/configCode/<%= configCode %>"),GetUserByEmailAndPassword:_.template("user/email/<%= email %>/password/<%= password %>"),GetUserByMasterId:_.template("user/id/<%= id %>"),GetUserByToken:_.template("user/token/<%= token %>")},u=function(u){var e="Get",s;try{return s=f+o[u.method](u.options.payload),t.debug(i,e,"calling...",s,"OPTIONS",r),n.ajax({headers:{"Site-Code":r.siteCode,"x-test":"test","Access-Control-Allow-Origin":"*",Environment:Connext.GetOptions().environment,settingsKey:Connext.GetOptions().settingsKey,attr:Connext.GetOptions().attr},url:s,type:"GET",dataType:"json",success:function(n,r,f){t.debug(i,e,"<< SUCCESS >>","textStatus",r,"data",n,"xhr",f);try{if(n&&f.status!=204){if(_.isFunction(u.options.onSuccess))u.options.onSuccess(n)}else _.isFunction(u.options.onNull)&&u.options.onNull()}catch(o){t.exception(e,o)}},error:function(n){t.error(e,"Ajax.Error",n);_.isFunction(u.options.onError)&&u.options.onError()},complete:function(){_.isFunction(u.options.onComplete)&&u.options.onComplete()}})}catch(h){console.log(i,e,"EXCEPTION",h);_.isFunction(u.options.onError)&&u.options.onError()}};return{init:function(n){t=Connext.Logger;r=n;f=r.api+e},GetConfiguration:function(n){return u({method:"GetConfiguration",options:n})},GetUserByEmailAndPassword:function(n){return u({method:"GetUserByEmailAndPassword",options:n})},GetUserByToken:function(n){return u({method:"GetUserByToken",options:n})},GetUserByMasterId:function(n){return u({method:"GetUserByMasterId",options:n})},GetLastPublishDateS3:function(){var u="GetLastPublishDateS3",f;try{return f=Connext.Common.S3RootUrl[r.environment]+"data/last_publish/"+r.siteCode+".json",t.debug(i,u,"jsonURL",f),n.ajax({crossDomain:!0,contentType:"application/json; charset=utf-8",async:!0,url:f,success:function(n){t.debug(i,u,"success",n)},error:function(n,r,f){t.debug(i,u,"error","a, b, c",n,r,f)}})}catch(e){console.error(i,u,"<<EXCEPTION>>",e)}}}},ConnextUser=function(n){var t="User",i,e,f={},c=!1,o={},l,a,p=!1,s={NotLoggedIn:"Logged Out",LoggedIn:"Logged In",Subscribed:"Subscribed"},r=s.NotLoggedIn,v={show:function(n){try{a.info(n).show()}catch(t){}},hide:function(){try{a.hide()}catch(n){}}},u={LoginButton:"[data-mg2-submit=login]:visible",LoginAlert:"[data-mg2-alert=login]:visible",InputUsername:"[data-mg2-input=Email]",InputPassword:"[data-mg2-input=Password]",ActionShowLogin:"[data-mg2-action=login]",LogoutButton:"[data-mg2-action=logout]",LoginModal:'<div data-mg2-alert="login" data-template-id="23" data-display-type="modal" data-width="400" id="mg2-login-modal"  tabindex="-1" class="Mg2-connext modal fade in"><div class="modal-body picker-bg"><i class="fa fa-times closebtn" data-dismiss="modal" aria-label="Close" aria-hidden="true"><\/i><form><h1 class="x-editable-text text-center h3">LOGIN<\/h1><p class="x-editable-text text-center m-b-2" >to save access to articles or get newsletters, allerts or recomendations â€” all for free<\/p><label class="textColor4 x-editable-text" >E-mail<\/label><input type="email" data-mg2-input="Email" class="text" name="email" value=""   data-mg2-input="Email" /><label class="textColor4 x-editable-text">Password<\/label><input type="password" data-mg2-input="Password" class="text" name="password" value=""  data-mg2-input="Password" /><a href="" data-mg2-submit="login" class="input submit x-editable-text" title="Login">Login<\/a><\/form><\/div><\/div>'},w=function(){var n="Init";try{i.debug(t,n,"Initializing User...");u.LoginModal=e.LoginModal;b()}catch(r){console.error(t,n,r)}},b=function(){var r="setAuthType";try{if(i.debug(t,r,"OPTIONS",e),e.Site.RegistrationTypeId==1)i.debug(t,r,"IsMG2Auth"),f.MG2=!0;else if(e.Site.RegistrationTypeId==2)i.debug(t,r,"IsJanrainAuth"),f.Janrain=!0,l=n(u.LoginButton).loader(),a=n(u.LoginAlert).jalert();else if(e.Site.RegistrationTypeId==3)f.GUP=!0;else throw"Unknown Registration Type";et();e.LoginModal}catch(o){console.error(t,r,"EXCEPTION",o)}},k=function(){var c="checkAccess",e=n.Deferred();if(r=Connext.Storage.GetUserState(),r!=null&&r!=undefined&&(f.Janrain&&(window.localStorage.getItem("janrainCaptureToken")||(r=s.NotLoggedIn,Connext.Storage.SetUserState(r))),r==s.NotLoggedIn?window.localStorage.getItem("janrainCaptureToken")?r=null:(Connext.Event.fire("onNotAuthorized",r),e.reject("onNotAuthorized")):(n(u.ActionShowLogin).hide(),n(u.LogoutButton).show(),r==s.LoggedIn?(Connext.Event.fire("onAuthorized",r),e.reject("onAuthorized")):r==s.Subscribed&&(Connext.Event.fire("onHasAccess",r),e.reject("onHasAccess"))),e.resolve(!0)),r==null||r==undefined)try{console.log(t,c,"AUTH_TYPE",f);o.Start=new Date;r=s.NotLoggedIn;Connext.Storage.SetUserState(r);g().done(function(s){if(i.debug(t,c,"getUserData.done -- result",s),!s)throw"No User Data Result";if(f.MG2)Connext.Storage.GetUserToken()?Connext.API.GetUserByToken({payload:{token:s},onSuccess:function(r){i.debug(t,c,"<< SUCCESS >>","data",r);h("Token",r);o.Done=new Date;e.resolve(!0);n(u.ActionShowLogin).hide();n(u.LogoutButton).show()},onNull:function(){i.debug(t,c,"<< NO RESULTS >>");o.Done=new Date;e.reject("GetUserByToken.onNull");Connext.Event.fire("onNotAuthorized",r)},onError:function(n){i.debug(t,c,"<< ERROR >>","err",n);o.Done=new Date;e.reject("GetUserByToken.onError");Connext.Event.fire("onNotAuthorized",r)}}):Connext.API.GetUserByMasterId({payload:{masterId:s},onSuccess:function(r){i.debug(t,c,"<< SUCCESS >>","data",r);h("MasterId",r);o.Done=new Date;e.resolve(!0);n(u.ActionShowLogin).hide();n(u.LogoutButton).show()},onNull:function(){i.debug(t,c,"<< NO RESULTS >>");o.Done=new Date;e.reject("GetUserByMasterId.onNull");Connext.Event.fire("onNotAuthorized",r)},onError:function(n){i.debug(t,c,"<< ERROR >>","err",n);o.Done=new Date;e.reject("GetUserMasterId.onError");Connext.Event.fire("onNotAuthorized",r)}});else if(f.Janrain)Connext.API.GetUserByMasterId({payload:{id:s},onSuccess:function(n){i.debug(t,c,"<< SUCCESS >>","data",n);h("Token",n);o.Done=new Date;e.resolve(!0)},onNull:function(){i.debug(t,c,"<< NO RESULTS >>");o.Done=new Date;e.reject("GetUserByToken.onNull")},onError:function(n){i.debug(t,c,"<< ERROR >>","err",n);o.Done=new Date;e.reject("GetUserByToken.onError")}});else if(f.GUP){var l=ft(s);o.Done=new Date;i.debug(t,c,"getUserData.done -- gupUserHasAccess",l);l?e.resolve():e.reject();i.debug(t,c,"getUserData.done","Has GUP Data",s)}else Connext.Event.fire("onCriticalError",{"function":"getUserData.done",error:"Unknown Registration Type"})}).fail(function(n){i.debug(t,c,"getUserData.fail -- err",n);o.Done=new Date;e.reject(n)})}catch(l){console.error(t,c,"EXCEPTION",l);o.Done=new Date;e.reject()}return e.promise()},h=function(u,e){var h="processSuccessfulLogin",c,a,l,o;try{r=s.LoggedIn;i.debug(t,h,"type",u,"data",e);y(!0);e.Subscriptions&&e.Subscriptions!=null?(_.isObject(e.Subscriptions)||(e.Subscriptions=n.parseJSON(e.Subscriptions)),c=_.map(e.Subscriptions,function(n){return n.PostalCode}),Connext.Storage.SetUserZipCodes(c),n("#ddZipCode").html(c.toString())):(v.show("NoSubscriptionData"),Connext.Event.fire("onNotAuthorized",r));u=="Token"&&Connext.Event.fire("onUserTokenSuccess",r);f.MG2||f.Janrain||f.GUP||Connext.Event.fire("onCriticalError",{"function":"processAuthentication",error:"Unknown Registration Type"});a=d(u,e);a?(i.debug(t,"hasAccess"),r=s.Subscribed,Connext.Event.fire("onHasAccess",r),Connext.Storage.SetAccessToken(e.MasterId),f.MG2&&(e.UserToken?Connext.Storage.SetUserToken(e.UserToken):Connext.Storage.SetUserRegId(e.MasterId)),l=n("body").data("modalmanager"),l&&(o=l.getOpenModals(),i.debug(t,h,"openModals",o),o.length>0&&o[0].isShown&&(v.show("AuthSuccess"),setTimeout(function(){o[0].$element.modal("hide")},1500))),Connext.Action.ShowContent()):Connext.Event.fire("onNotAuthorized",r);Connext.Storage.SetUserState(r)}catch(p){console.error(t,h,"EXCEPTION",p)}},d=function(r,u){var f="checkSubscriptionsForAccess",o,s;try{return(i.debug(t,f,"OPTIONS",e,"data",u),u.Subscriptions.length==0)?(i.debug(t,f,"user has not subscriptions",null),!1):(_.isString(e.AccessRules)&&(e.AccessRules=n.parseJSON(e.AccessRules)),u.DigitalAccess)?_.where([u.DigitalAccess],e.AccessRules).length>0:(o=_.where(u.Subscriptions,e.AccessRules),i.debug(t,f,"allowedAccts",o),s={type:r,uid:u.MasterId,user:u.User?u.User:null,subscriptions:u.Subscriptions,accessRules:e.AccessRules},o.length>0?(s.authorizedSubscriptions=o,Connext.Event.fire("onAuthorized",s),!0):(Connext.Event.fire("onNotAuthorized",s),!1))}catch(h){return console.error(t,f,"EXCEPTION",h),!1}},g=function(){var e="getUserData",u=n.Deferred(),o,c,h;try{f.MG2?(o=Connext.Storage.GetUserToken(),c=Connext.Storage.GetUserRegId(),i.debug(t,e,"userToken",o),o?(Connext.Event.fire("onHasUserToken",{token:o}),u.resolve(o)):c?u.resolve(o):u.reject("No MG2 UserToken")):f.Janrain?window.JANRAIN?window.localStorage.getItem("janrainCaptureToken")?(i.debug(t,e,"Janrain Loaded"),h=tt(),i.debug(t,e,"janrainProfile",h),h.uuid?(r=s.LoggedIn,u.resolve(h.uuid)):u.reject("No Janrain Profile Data")):(r=s.NotLoggedIn,Connext.Storage.SetUserState(r),u.reject("Janrain Logged out User")):(r=s.NotLoggedIn,Connext.Storage.SetUserState(r),u.reject("Janrain object is exist")):f.GUP?ut().then(function(n){i.debug(t,e,"getCurrentGUPUser.then (data)",n);n&&u.resolve(n)}).fail(function(n){i.debug(t,e,"getCurrentGUPUser.fail (error)",n);u.reject()}):(Connext.Event.fire("onCriticalError",{"function":"getUserData",error:"Unknown Registration Type"}),u.reject("Unknown Registration Type"))}catch(l){console.error(t,e,"EXCEPTION",l)}return u.promise()},nt=function(){var n="logoutUser";try{i.debug(t,n);f.MG2||f.Janrain?y(!1):f.GUP&&st().then(function(r){r&&i.debug(t,n,"logoutGUPUser.then",r)}).fail(function(i){console.error(t,n,"Exception",i)});Connext.Storage.SetUserState(s.NotLoggedIn);Connext.Run()}catch(r){console.error(t,n,"EXCEPTION",r)}},tt=function(){var r="getJanrainProfileData",i;try{return i=window.localStorage.getItem("janrainCaptureProfileData"),i==null&&(i=window.localStorage.getItem("janrainCaptureReturnExperienceData")),i?n.parseJSON(i):!1}catch(u){return console.log(t,r,"EXCEPTION",u),!1}},it=function(n){var r="janrainAuthenticationCallback";try{if(i.debug(t,r,n),!n.userData.uuid)throw"No userData UUID";Connext.API.GetUserByMasterId({payload:{id:n.userData.uuid},onSuccess:function(n){i.debug(t,r,"<< SUCCESS >>","data",n);h("Form",n)},onNull:function(){i.debug(t,r,"<< NO RESULTS >>")},onError:function(n){i.debug(t,r,"<< ERROR >>","err",n)}})}catch(u){console.error(t,r,"EXCEPTION",u)}},rt=function(){var n=500,t=600,i=screen.width/2-n/2,r=screen.height/2-t/2,u=window.open("//login-stage.jconline.com/PLAI-GUP-MG2/authenticate/?window-mode=popup","_blank","toolbar=no, scrollbars=yes, resizable=no, width="+n+", height="+t+", top="+r+", left="+i);return},ut=function(){return i.debug("User","getCurrentGUPUser"),n.ajax({type:"POST",url:"//user-stage.jconline.com/PLAI-GUP-MG2/user/?callback=?",contentType:"application/json; charset=utf-8",dataType:"json",async:!0})},ft=function(n){var r="authenticateGUPUser";try{return i.debug(t,r),!n.meta.isAnonymous&&n.response.user?n.response.user.hasMarketAccess?(i.debug(t,r,"GUP User <<IS>> LOGGED IN, AND has market access"),!0):(i.debug(t,r,"GUP User <<IS>> LOGGED IN, but doesnt have marketAccess"),!1):(i.debug(t,r,"GUP User <<NOT>> LOGGED IN"),!1)}catch(u){return console.error(t,r,"EXCEPTION",u),!1}},et=function(){var n="registerEventlisteners";try{if(f.GUP)window.jQuery(window).on("focus.gup_login_popup",function(){i.debug("focus.gup_login_popup")})}catch(r){console.error(t,n,"EXCEPTION",r)}};n("body").on("click",u.LogoutButton,function(n){n.preventDefault();var r=u.LogoutButton+".CLICK";i.debug(t,r);nt()});n("body").on("click",u.LoginButton,function(r){r.preventDefault();var e=u.LoginButton+".CLICK";i.debug(t,e);try{l=n(u.LoginButton).loader();a=n(u.LoginAlert).jalert();l.on();f.MG2?ot(n(u.InputUsername+":visible").val(),n(u.InputPassword+":visible").val()):JanrainAuthenticate(n("[data-mg2-input=Username]:visible").val(),n("[data-mg2-input=Password]:visible").val())}catch(r){console.error(t,e,"<<EXCEPTION>>",r)}});n("body").on("click",u.ActionShowLogin,function(r){r.preventDefault();var e=u.ActionShowLogin+".Click";try{i.debug(t,e,"IS_LOGGED_IN",c);f.MG2?(n(u.LoginModal).addClass("in"),n(u.LoginModal).attr("id","mg2-login-modal"),n(u.LoginModal).connextmodal({backdrop:"true"}),n(u.LoginModal).css("display","block"),n("[data-display-type=modal]").resize()):f.GUP&&rt(window)}catch(r){console.error(t,e,"Exception",r)}});var ht=function(i){var r="setLoginModal";try{f.MG2&&n("body").append(i)}catch(u){console.error(t,r,"EXCEPTION",u)}},y=function(i){var o="handleUILoggedInStatus",e;try{e=n(u.ActionShowLogin);c=i;r=i?s.LoggedIn:s.NotLoggedIn;(f.MG2||f.Janrain)&&(c?(n(u.LogoutButton).show(),n(u.ActionShowLogin).hide(),e.html(e.data("mg2-logged-in")),Connext.Event.fire("onAuthorized",null)):(e.html(e.data("mg2-logged-out")),Connext.Storage.ClearUser(),n(u.LogoutButton).hide(),n(u.ActionShowLogin).show(),Connext.Event.fire("onNotAuthorized",null),n("#ddZipCode").html(n.jStorage.get("CustomZip"))))}catch(h){console.error(t,o,"EXCEPTION",h)}},ot=function(r,f){var e="MG2Authenticate";try{i.debug(t,e);Connext.API.GetUserByEmailAndPassword({payload:{email:r,password:f},onSuccess:function(r){i.debug(t,e,"<< SUCCESS >>","data",r);h("Form",r);n(u.ActionShowLogin).hide();n(u.LogoutButton).show();n("[data-mg2-alert=login]").connextmodal("hide");Connext.Run()},onNull:function(){i.debug(t,e,"<< NO RESULTS >>");v.show("NotAuthenticated")},onError:function(n){i.debug(t,e,"<< ERROR >>","err",n);v.show("GenericAuthFailed")},onComplete:function(){l.off()}})}catch(o){console.error(t,e,"EXCEPTION",o)}},st=function(){return i.debug("User","logoutGUPUser"),n.ajax({type:"POST",url:"//user-stage.jconline.com/PLAI-GUP-MG2/user/logout/?callback=?",contentType:"application/json; charset=utf-8",dataType:"json",async:!0})};return{init:function(n){i=Connext.Logger;e=n?n:{};w()},CheckAccess:function(){return k()},GetAuthTiming:function(){return o},JanrainLoaded:function(){p=!0;i.debug(t,"JanrainLoaded")},onLoginSuccess:function(n){i.debug(t,"onLoginSuccess",n);it(n)},getUserState:function(){return Connext.Storage.GetUserState()},onLogout:function(){i.debug(t,"onLogout");c=!1;Connext.Storage.ClearUser()}}},ConnextMeterCalculation=function(n){function e(r){var f="evalArticleAge",u=n.Deferred(),e,o;try{i.debug(t,f,"-- Testing ---");e=y(r.Options);o=r.Options.Qualifier=="="?"==":r.Options.Qualifier;eval(e+o+r.Options.Val)?(console.log("PASSES"),u.resolve()):(console.log("NOT PASSED"),u.reject())}catch(s){console.error(t,f,s);u.reject(!1)}return u.promise()}function o(r){var f="evalUrlParam",u=n.Deferred(),e,o;try{i.debug(t,f,"-- Testing ---");e=Connext.Utils.GetUrlParam(r.Options.ParamName);o=Connext.Common.QualifierMap[r.Options.Qualifier];e!=null?eval("'"+e.toUpperCase()+"'"+o+"'"+r.Options.Val.toUpperCase()+"'")?(i.debug(t,f,"Segment["+r.id+"] --- Passed"),u.resolve()):(i.debug(t,f,"Segment["+r.id+"] --- FAILED"),u.reject()):o=="=="?u.reject():u.resolve()}catch(s){console.error(t,f,s);u.reject()}return u.promise()}function s(r){var o="evalHiddenField",u=n.Deferred(),e,f,s,h;try{i.debug(t,o,"-- Testing ---");e=!1;f=r.Options.Selector.trim()?n(r.Options.Selector+"[type='hidden']"):null;f&&f.length>0&&(s=n(f[0]).val(),h=Connext.Common.QualifierMap[r.Options.Qualifier],e=eval("'"+s.toUpperCase()+"'"+h+"'"+r.Options.Val.toUpperCase()+"'"));e?(console.log("PASSES"),u.resolve()):(console.log("NOT PASSED"),u.reject())}catch(c){console.error(t,o,c);u.reject(!1)}return u.promise()}function h(r){var f="evalSubdomain",u=n.Deferred();try{i.debug(t,f,"-- Testing ---");var e="."+r.Options.Val.toUpperCase()+".",o="."+window.location.hostname.toUpperCase(),s=r.Options.Qualifier.toUpperCase();s=="IN"^o.includes(e)?(console.log("NOT PASSED"),u.reject()):(console.log("PASSES"),u.resolve())}catch(h){console.error(t,f,h);u.reject(!1)}return u.promise()}function c(t){var i=!1,r=n.Deferred();try{Connext.Storage.GetUserZipCodes()?n.each(Connext.Storage.GetUserZipCodes(),function(n,r){if(t.Options.Zipcodes.indexOf(r)>=0)return i=t.Options.GeoQalifier.toUpperCase()=="IN",!1;i=t.Options.GeoQalifier.toUpperCase()!="IN"}):i=t.Options.Zipcodes.indexOf(Connext.Utils.GetUserZipcode())>=0?t.Options.GeoQalifier.toUpperCase()=="IN":t.Options.GeoQalifier.toUpperCase()!="IN"}catch(u){i=!1}return i?(console.log("PASSES"),r.resolve()):(console.log("NOT PASSED"),r.reject()),r.promise()}function l(r){var o="evalJSVar",u=n.Deferred(),f,e;try{i.debug(t,o,"-- Testing ---");f=!1;e=window[r.Options.VarName];e!=undefined&&(f=Connext.Utils.JSEvaluate(e.toString().toUpperCase(),r.Options.Qualifier,r.Options.Val.toUpperCase(),"string"));f?(console.log("PASSES"),u.resolve()):(console.log("NOT PASSED"),u.reject())}catch(s){console.error(t,o,s);u.reject(!1)}return u.promise()}function a(i){var e="evalUserState",r=n.Deferred(),f,u;try{f=!1;u=Connext.User.getUserState();u==null&&(u="Logged Out");f=u==i.Options["User State"];f?(console.log("PASSES"),r.resolve()):(console.log("NOT PASSED"),r.reject())}catch(o){console.error(t,e,o);r.reject(!1)}return r.promise()}function v(r){var o="evalMeta",f=n.Deferred(),e;try{i.debug(t,o,"-- Testing ---");var u=!1,s=Connext.Utils.getMetaTagsWithKeywords(),h="\\b"+r.Options.Val+"\\b",c=new RegExp(h);for(e=0;e<s.length;e++)if(c.test(s[e].content)){i.debug(t,o,"Found keyword",r.Options.Val);u=!0;break}u&&r.Options.Qualifier=="Not Equal"&&(u=!1);u||r.Options.Qualifier!="Not Equal"||(u=!0);u?(console.log("PASSES"),f.resolve()):(console.log("NOT PASSED"),f.reject())}catch(l){console.error(t,o,l);f.reject(!1)}return f.promise()}function y(u){var f="getArticleAge",o,e;try{if(i.debug(t,f,u),_.isNumber(r.articleAge))return i.debug(t,f,"Article Age Already Deterimed...using Cached value"),r.articleAge;o=_.isNothing(u.Format)?Connext.Common.DefaultArticleFormat:u.Format;i.info(t,f,"Using Format: ",o);e=n(u.Selector).text();i.info(t,f,"articleDateData",e);var h=Connext.Utils.ParseCustomDate(e,o),c=Connext.Utils.Now(),s=c.diff(h,"days");return i.debug(t,f,"Date Used for Compare: "+e,"Article Age In Days:: ("+s+")"),r.articleAge=s,r.articleAge}catch(l){return console.error(t,f,l),!1}}var t="MeterCalculation",i,u={ArticleAge:e,HiddenField:s,Subdomain:h,Geo:c,Url:o,JSVar:l,Meta:v,UserState:a},r={},f=function(r){var f="calculateMeterLevel",e=n.Deferred(),o;try{i.debug(t,f,"calculating meter level....");o=!1;n.each(r,function(r,s){if(i.debug(t,f,"rules.each",r,s),o)i.debug(t,f,"Rule Already Set...Skipping this rule.");else{var h=!0;n.each(s.Segments,function(n,r){i.debug(t,f,"segments.each",n,r);h?u[r.SegmentType](r).done(function(){i.debug(t,f,"Segment["+r.id+"] --- PASSED")}).fail(function(){h=!1;i.debug(t,f,"Segment["+r.id+"] --- FAILED")}):i.debug(t,f,"Previous Segment Failed, Not processing rest of segments.")});h&&(i.debug(t,f,"All Segments Passed, Using ["+s.Name+"] Rule "),o=!0,e.resolve(s))}});o||e.reject()}catch(s){console.error(t,f,"EXCEPTION",s);e.reject(s)}return e.promise()};return{init:function(){i=Connext.Logger;i.debug(t,"MeterCalculation.Init")},CalculateMeterLevel:function(n){return f(n)}}},ConnextCampaign=function(n){var t="Campaign",h="{{ArticleLeft}}",r,i,u,c,l=function(n,f){var e="processCampaign";try{if(r.debug(t,e,n),!n)throw"No Meter Level Set";if(!f)throw"No Campaign Data.";if(u=n,i=y(n),i)r.debug(t,e,"Conversation To Process",i),a();else throw Connext.Common.ERROR.NO_CONVO_FOUND;}catch(o){console.error(t,e,"EXCEPTION",o);Connext.Event.fire("onCriticalError",o)}},a=function(){var u="processConversation",f;try{r.debug(t,u);g();Connext.Event.fire("onConversationDetermined",i);v();f=b();f.length>0?(r.debug(t,u,"ACTIONS DETERMINGED ---> ",f),Connext.Action.ProcessActions(f)):r.warn(t,u,"No 'Actions' to execute.");n(".dev_article_left").html(i.Props.ArticleLeft)}catch(e){console.error(t,u,"EXCEPTION",e)}},v=function(){var u=99999,f;r.debug(t,"getCurrentConversation","Try to find paywalls");f=_.where(i.Actions,{ActionTypeId:3});f.length>0?(r.debug(t,"paywalls found",f),n.each(f,function(t,i){var r=-1;i.Who.Views&&n.each(i.Who.Views,function(n,t){t.Qualifier=="=="||t.Qualifier==">="?r=t.Val>r?t.Val:r:t.Qualifier==">"&&(r=parseInt(t.Val)+1>r?parseInt(t.Val)+1:r)});u>r&&(u=r)}),u==-1&&(u=99999),i.Props.ArticleLeft=u==99999?"unlimited":u-s(),i.Props.ArticleLeft<0&&(i.Props.ArticleLeft=0),n.each(i.Actions,function(n,t){t.What.Html&&(t.What.Html=t.What.Html.split(h).join('<span class="dev_article_left"><\/span>'))})):i.Props.ArticleLeft="unlimited";n("#ddCurrentConversationArticleLeft").html(i.Props.ArticleLeft)},y=function(){var n="getCurrentConversation",f,o;try{if(f=k(u),f){if(r.debug(t,n,"Found Stored Conversation",f),i=f,p())return r.debug(t,n,"Found Stored Conversation --- IS VALID"),i;if(r.debug(t,n,"Found Stored Conversation --- NOT VALID"),i=w(),i)return i;Connext.Event.fire("onDebugNote","Conversation Expire: "+i.Props.expiredReason)}else{if(o=e(u),o)return i=o[0],r.debug(t,n,"No Current Conversation Stored....Using first conversation in campaign",i),d(),i;r.debug(t,n,"No Conversation for this meter level")}return r.debug(t,n,"NO RETURN FIRED, USING CATCH ALL"),!1}catch(s){return console.error(t,n,"EXCEPTION",s),!1}},p=function(){var n="isConversationValid",u;try{if(i.Props.isExpired)return r.debug(t,n,"Current conversation was previously set to expired."),!1;if(i.Props.Date.expiration){var s=Connext.Utils.Now(),f=new Date(Date.parse(i.Props.Date.expiration)),e=()=>f;if(e)return r.debug(t,n,"Current conversation has expired base on date..."),i.Props.isExpired=!0,i.Props.expiredReason="Time",!1}else r.debug(t,n,"No expiration time set for this conversation.");return i.Options.Expirations.UserState&&((u=i.Options.Expirations.UserState,u["User State"]==Connext.User.getUserState())||u["User State"]=="Logged In"&&Connext.User.getUserState()=="Subscribed")?(i.Props.expiredReason="UserState",!1):!0}catch(o){return console.error(t,n,"EXCEPTION",o),!0}},w=function(){var o="getNextConversation",n,f;try{return n=i.Props.expiredReason,f=i.Options.Expirations[n].nextConversation,r.debug(t,o,"ExpirationReason",n,f,e(u)),i=_.findByKey(e(u),{id:f})}catch(s){console.error(t,o,"EXCEPTION",s)}},b=function(){var u="determineConversationActions";try{r.debug(t,u,i.Actions);var e=[],o=!1,h=s();return n.each(i.Actions,function(s,c){var a,l,v,y,b;if(r.debug(t,u,"Actions.EACH",c),c.ActionTypeId!=3||i.Props.paywallLimit||(i.Props.paywallLimit=c.Who.Views[0].Val,f()),c.ActionTypeId!=3||!o){a=!0;try{if(l=c.Who,l.Views&&n.each(l.Views,function(n,i){r.debug(t,u,"Who.Views.EACH",'ViewCriteria:: viewCount="'+h+'" -- Qualifier="'+i.Qualifier+'" -- Value="'+i.Val+'"');Connext.Utils.JSEvaluate(parseInt(h),i.Qualifier,parseInt(i.Val),"ArticleView","integer")?r.debug(t,u,"Who.Views.EACH","ViewCriteria:: "+i.Qualifier+" "+parseInt(i.Val)+" ---------------------- View Criteria PASSED"):(a=!1,r.debug(t,u,"Who.Views.EACH","ViewCriteria:: "+i.Qualifier+" "+parseInt(i.Val)+" ---------------------- View Criteria FAILED"))}),l.HiddenFieldCriteria&&a==!0&&(r.debug(t,u,"Checking Hidden Field",l.HiddenFieldCriteria),Connext.Utils.JSEvaluate(Connext.Utils.GetHiddenFormFieldValue(l.HiddenFieldCriteria.Id),l.HiddenFieldCriteria.Qualifier,l.HiddenFieldCriteria.Val,"HiddenFormField")||(a=!1)),l.GeoCriteria&&a==!0)try{r.debug(t,u,"Checking GeoCriteria Field",l.GeoCriteria);Connext.Storage.GetUserZipCodes()?_.each(Connext.Storage.GetUserZipCodes(),function(n){if(l.GeoCriteria.Zip.indexOf(n)>=0){a=l.GeoCriteria.Type=="In";return}a=l.GeoCriteria.Type!="In"}):(a=l.GeoCriteria.Zip.indexOf(Connext.Utils.GetUserZipcode())>=0?l.GeoCriteria.Type=="In":l.GeoCriteria.Type!="In",l.GeoCriteria.Type==undefined&&(a=!0))}catch(rt){a=!1}if(l.JavascriptCriteria&&a==!0){r.debug(t,u,"Checking Javscript");try{v=eval(l.JavascriptCriteria.Eval);v!=undefined&&(v=v.toString().toLowerCase());Connext.Utils.JSEvaluate(v,l.JavascriptCriteria.Qualifier,l.JavascriptCriteria.Val.toLowerCase(),"JavascriptCriteria")||(a=!1)}catch(rt){r.debug(t,u,"Error evaluating javascript criteria.");a=!1}}if(l.ScreenSizeCriteria&&a==!0&&(r.debug(t,u,"Checking Screen Size",l.ScreenSizeCriteria),Connext.Utils.JSEvaluate(Connext.Utils.getDeviceType(),"==",l.ScreenSizeCriteria.Value,"ScreenSizeCriteria","string")||(a=!1)),l.UrlCriteria&&a==!0&&(r.debug(t,u,"Checking Url params",l.UrlCriteria),Connext.Utils.JSEvaluate(Connext.Utils.getUrlParam(l.UrlCriteria.Eval),l.UrlCriteria.Qualifier,l.UrlCriteria.Value,"UrlCriteria")||(a=!1)),l.SubDomainCriteria&&a==!0){r.debug(t,u,"Checking Sub-domain",l.SubDomainCriteria);var k="."+l.SubDomainCriteria.Value.toUpperCase()+".",d="."+window.location.hostname.toUpperCase(),g=l.SubDomainCriteria.Qualifier.toUpperCase();g=="=="^d.includes(k)&&(a=!1)}if(l.MetaKeywordCriteria&&a==!0){r.debug(t,u,"Checking meta keyword",l.MetaKeywordCriteria);var w=Connext.Utils.getMetaTagsWithKeywords(),p=!1,nt="\\b"+l.MetaKeywordCriteria.Value+"\\b",tt=new RegExp(nt);for(y=0;y<w.length;y++)if(tt.test(w[y].content)){r.debug(t,u,"Found keyword",l.MetaKeywordCriteria.Value);p=!0;break}p&&l.MetaKeywordCriteria.Qualifier=="!="&&(a=!1);p||(a=l.MetaKeywordCriteria.Qualifier=="!="?!0:!1)}l.UserStateCriteria&&a==!0&&(r.debug(t,u,"Checking user state",l.UserStateCriteria),b=Connext.User.getUserState(),Connext.Utils.JSEvaluate(b,"==",l.UserStateCriteria.Value)||(a=!1))}catch(it){a=!1;console.error(t,u,"EXCEPTION",it)}a?(r.debug(t,u,"===== ACTION PASSED =====",c),c.ActionTypeId==3&&(o=!0),e.push(c)):r.debug(t,u,"%%%%% ACTION FAILED %%%%%",c)}}),e}catch(c){console.error(t,u,"EXCEPTION",c)}},k=function(n){var u="getStoredConversationByMeterLevel",f,i;try{return r.debug(t,u,"meterLevel",n),f=null,i=Connext.Storage.GetCurrentConversations(),r.debug(t,u,"currentConversations",i),i&&(f=i[n]),f}catch(e){return console.error(t,u,"EXCEPTION",e),!1}},e=function(n){var i="getAllConversationsMeterLevel";try{return r.debug(t,i,"meterLevel",n),Connext.Storage.GetCampaignData().Conversations[n]}catch(u){return console.error(t,i,"EXCEPTION",u),!1}},f=function(){var f="saveCurrentConversation",r;try{r=Connext.Storage.GetCurrentConversations();r[u]=i;n.jStorage.set(Connext.Common.StorageKeys.conversations.current,r);Connext.Storage.GetCurrentConversations()[u]}catch(e){console.error(t,f,"EXCEPTION",e)}},d=function(){var u="setDefaultConversationProps",n;try{n=Connext.Utils.Now();i.Props.Date.started=n.format();i.Options.Expirations.Time?i.Props.Date.expiration=n.add(i.Options.Expirations.Time.val,i.Options.Expirations.Time.key).format():r.debug(u,"No expiration time set for this conversation.");f()}catch(e){console.error(t,u,"EXCEPTION",e)}},g=function(){var i="handleArticleView";try{r.debug(t,i);n.jStorage.get("uniqueArticles")?nt():o()}catch(u){console.error(t,i,"EXCEPTION",u)}},nt=function(){var n="hasArticleBeenViewed";try{_.contains(Connext.Storage.GetViewedArticles(i.id),Connext.Utils.GetUrl())?r.debug(t,n,"Article already viewed"):(r.debug(t,n,"Article HAS NOT been viewed"),Connext.Storage.UpdateViewedArticles(i.id),o())}catch(u){console.error(t,n,"EXCEPTION",u)}},o=function(n){var u="updateArticleViewCount";try{r.debug(t,u);i.Props.views=_.isNumber(arguments[0])?n:i.Props.views+1;f()}catch(e){console.error(t,u,"EXCEPTION",e)}},s=function(){var r="getCurrentConversationViewCount";try{return n.jStorage.get("uniqueArticles")?Connext.Storage.GetViewedArticles(i.id).length:i.Props.views}catch(u){console.error(t,r,"EXCEPTION",u)}},tt=function(n){var u="eventCompleted";try{r.debug(t,u);i.Props.isExpired=!0;i.Props.expiredReason=n;f()}catch(e){console.error(t,u,"EXCEPTION",e)}};return{init:function(n){r=Connext.Logger;c=n;r.debug(t,"Campaign.Init")},ProcessCampaign:function(n,t){return l(n,t)},GetCurrentConversationProps:function(){try{return i.Props}catch(n){return console.error(t,"GetCurrentConversationProps.Exception",n),null}},GetCurrentConversation:function(){return i},EventCompleted:function(){var n="EventCompleted";try{}catch(i){console.error(t,n,"<<EXCEPTION>>",i)}}}},ConnextAction=function(n){var t="Action",r,o="ConneXt_Action_Id-",i,u,s=!1,f={CloseButton:"closeButton",CloseSpan:"closeSpan",ClickOutside:"clickOutside",EscButton:"escButton"},c="[data-fz-btn=smartAuth]",l=function(i){var u="processActions";try{r.debug(t,u,i);n.each(i,function(n,i){r.debug(t,u,"Actions.EACH",n,i);i.What.Html?a(i):r.debug(t,u,"ACTION has no html")})}catch(f){console.error(t,u,"EXCEPTION",f)}},a=function(i){var f="handleAction",u;try{r.debug(t,f,"action",i);u=i.What.Html.trim();u=d(u);u=n(u).prop("id",o+i.id);console.info("ACTION HTML",u);n(u).addClass("hide");n("body").append(u);y(i)}catch(e){console.error(t,f,"EXCEPTION",e)}},e=function(u){var a="executeAction",e,l,it,d,nt,y,s,p,w,b,g,k;try{if(r.debug(t,a,u),e=n("#"+o+u.id),e.removeClass("hide"),u.What.Type=="1"&&(l=u.What.Location?u.What.Location:"top",it=!1,u.What.Stickyness==="sticky"?e.addClass("affix sticky-"+l+" banner-sticky"):e.addClass("affix sticky-"+l).affix({offset:15}),d={},d[l]="0px",e.css(l,"-2500px").removeClass("hide"),nt=e.outerHeight(),e.css(l,"-"+nt+"px").animate(d,function(){})),u.What.Type=="2"){e.addClass("in");e.connextmodal({backdrop:"true"});e.resize();e.css("display","block");u.What["Transparent backdrop"]=="True"||u.What["Transparent backdrop"]=="true"?n(".modal-backdrop.fade.in").addClass("transparent"):n(".modal-backdrop.fade.in").removeClass("transparent");n(e).on("hidden",function(){(u.closeEvent==null||u.closeEvent==undefined)&&(u.closeEvent=f.EscButton,u.actionDom=e,Connext.Event.fire("onActionClosed",u))})}if(u.What.Type=="3"){if(y=e.data("display-type"),r.debug(t,a,"displayType",y),y=="inline")h(u),e.remove(),s=n(i).width(),p=String(s).length<4?String(s)[0]+"00":String(s)[0]+String(s)[1]+"00",e.addClass("Mg2-inline-scale-"+p),n(i).append(e),n(window,i).resize(function(){var t=n(i).width(),r=String(t).length<4?String(t)[0]+"00":String(t)[0]+String(t)[1]+"00",u=e.attr("class").replace(/\b\sMg2-inline-scale-\d+\b/g,"");e.attr("class",u);e.addClass("Mg2-inline-scale-"+r)});else if(y=="modal"){e.addClass("in");e.connextmodal({backdrop:"true"});e.resize();e.css("display","block");h(u);u.What.Transparent_backdrop_paywall=="True"||u.What.Transparent_backdrop_paywall=="true"?n(".modal-backdrop.fade.in").addClass("transparent"):n(".modal-backdrop.fade.in").removeClass("transparent");n(e).on("hidden",function(){(u.closeEvent==null||u.closeEvent==undefined)&&(u.closeEvent=f.EscButton,u.actionDom=e,Connext.Event.fire("onActionClosed",u))})}else r.warn(t,a,"Can't determine display type.");n("#ConneXt_Action_Id-"+u.id).find(c).click(function(n){u.Conversation=Connext.Campaign.GetCurrentConversation();u.Conversation.Campaign=Connext.Storage.GetCampaignData();u.ButtonArgs=n;u.ActionDom=e;Connext.Event.fire("onFlittzButtonClick",u)})}if(u.What.Type=="4"&&(i=u.What.Selector,s=n(i).width(),p=String(s).length<4?String(s)[0]+"00":String(s)[0]+String(s)[1]+"00",e.addClass("Mg2-inline-scale-"+p),n(i).append(e),n(window,i).resize(function(){var t=n(i).width(),r=String(t).length<4?String(t)[0]+"00":String(t)[0]+String(t)[1]+"00",u=e.attr("class").replace(/\b\sMg2-inline-scale-\d+\b/g,"");e.attr("class",u);e.addClass("Mg2-inline-scale-"+r)})),u.What.Type=="6"&&e.removeClass("hide"),u.What.Type=="7"){n("#ConneXt_Action_Id-"+u.id).remove();try{u.What.Javascript!=undefined&&eval(u.What.Javascript)}catch(tt){console.error(t,a,"Custom JS Call exception",tt)}}w=e.attr("id");n("#"+w+" [data-dismiss=info-box], #"+w+" [data-dismiss=inline], #"+w+"  [data-dismiss=modal]").on("click",function(){console.log("mg2-connext-info-box.CLICK");$btn=n(this);$btn.hasClass("closebtn")?u.closeEvent=f.CloseButton:$btn.hasClass("closeSpan")&&(u.closeEvent=f.CloseSpan);$btn.closest(".Mg2-connext").addClass("hide");u.actionDom=e;Connext.Event.fire("onActionClosed",u)});for(b=e[0].parentNode,g=!1,k=0;k<b.classList.length;k++)if(b.classList[k]=="modal-scrollable"){g=!0;break}if(u.actionDom=e,g)n(b).on("click.modal",v(function(){u.closeEvent=f.ClickOutside;Connext.Event.fire("onActionClosed",u)}));Connext.Event.fire("onActionShown",u)}catch(tt){console.error(t,a,"EXCEPTION",tt)}},v=function(n){return function(t){if(t&&this===t.target)return n.apply(this,arguments)}},y=function(n){var i="registerActionEvents";try{r.debug(t,i,"action",n);n.When||(n.When={Time:{Delay:0}});n.When&&n.When.Time?p(n):n.When&&n.When.Hover?b(n):n.When&&n.When.EOS?w(n):console.log(t,i,"NO ACTION TO REGISTER",n)}catch(u){console.error(t,i,"EXCEPTION",u)}},p=function(n){var i="setTimedAction";try{setTimeout(function(){e(n)},n.When.Time.Delay)}catch(r){console.error(t,i,"EXCEPTION",r)}},w=function(i){var r="setTimedAction";try{i.count=0;actionElem="#ConneXt_Action_Id-"+i.id;setTimeout(function(){n(i.When.EOS.Selector).viewportChecker({offset:10,classToAdd:"visible-"+i.id,callbackFunctionBeforeAddClass:function(t){if(!t.hasClass("visible-"+i.id)){var r=Connext.Storage.GetRepeatablesInConv(i.id);n(actionElem).hasClass("hide")&&i.When.EOS.Repeatable>i.count&&i.When.EOS.RepeatableConv>r&&(i.inProggress||(i.inProggress=!0,e(i),i.count++,i.inProggress=!1,Connext.Storage.UpdateRepeatablesInConv(i.id)))}},callbackFunction:function(t){n(t).removeClass("visible"+i.id)},repeat:!0,scrollHorizontal:!1})},i.When.EOS.Delay)}catch(u){console.error(t,r,"EXCEPTION",u)}},b=function(i){var u="setTimedAction",r;try{r=i.When.Hover.Delay?i.When.Hover.Delay:0;setTimeout(function(){var t=0,r="#ConneXt_Action_Id-"+i.id;n(i.When.Hover.Selector).on("mouseenter",function(u){if(u.stopPropagation(),_.isNumber(parseInt(i.When.Hover.Repeatable))&&_.isNumber(parseInt(i.When.Hover.RepeatableConv))){var f=Connext.Storage.GetRepeatablesInConv(i.id);if(n(r).hasClass("hide"))t<i.When.Hover.Repeatable&&i.When.Hover.RepeatableConv>f&&(e(i),t++,Connext.Storage.UpdateRepeatablesInConv(i.id));else return!1}}).children().mouseover(function(){if(i.When.Hover.IncludeChildren=="False")return!1})},r)}catch(f){console.error(t,u,"EXCEPTION",f)}},h=function(r){var s="hideContent";try{u=r.What.Effect;i=r.What.Selector;TERMINATOR=r.What.Terminator;var e=r.What.PrevChars,f=0,o=n(i)[0],h=o.childNodes;u&&t(o,h);n(".flittz").removeClass("blurry-text");n(".flittz").removeClass("trimmed-text");function t(n,i){for(var r,o,v,c,l,y=new RegExp(/script|style|meta/i),h=0;h<i.length;h++)if(r=i[h],f>e)u=="blur"?r.classList?r.classList.add("blurry-text"):(o=document.createElement("span"),o.innerHTML=r.textContent,o.classList.add("blurry-text"),r.parentNode.insertBefore(o,r),n.removeChild(r)):r.classList?r.classList.add("trimmed-text"):(o=document.createElement("span"),o.innerHTML=r.textContent,o.classList.add("trimmed-text"),r.parentNode.insertBefore(o,r),n.removeChild(r));else if(r.tagName)y.test(r.tagName)||t(r,r.childNodes);else if(f+=r.length,e<=f){var p=f-e,s=r.textContent.substr(0,r.textContent.length-p),a=Math.min(s.length,s.lastIndexOf(" "));for(a!=-1?(s=s.substr(0,a)+TERMINATOR,v=r.textContent.substr(a)):(v=r.textContent.substr(s.length),s+=TERMINATOR),r.textContent=s,c=document.createElement("span"),c.innerHTML=v,c.classList.add(u=="blur"?"blurry-text":"trimmed-text"),n.insertBefore(c,i[h+1]),l=h+1;l<i.length;l++)r=i[l],r.classList&&(y.test(r.tagName)||r.classList.add(u=="blur"?"blurry-text":"trimmed-text"))}}}catch(c){console.error(t,s,"EXCEPTION",c)}},k=function(){var f="showContent";try{r.debug(t,f);u?u=="blur"?n(i).removeClass("blurry-text"):u=="trim"&&s&&n(i).html(s):r.warn(t,f,"No Masking Method Set.")}catch(e){console.error(t,f,"EXCEPTION",e)}},d=function(n){var r="handleDynamicHtml";try{var i=Connext.Campaign.GetCurrentConversationProps();return n.replace(/{{(.*?)}}/g,function(n){switch(n){case"{{FreeViewsLeft}}":var t=eval(i.paywallLimit-i.views);return parseInt(t)<0&&(t=0),t;case"{{CurrentViewCount}}":return i.views}})}catch(u){return console.error(t,r,"EXCEPTION",u),n}},g=function(){n("body").on("click","[data-mg2-action=click]",function(n){Connext.Event.fire("onButtonClick",n)})};return{init:function(){r=Connext.Logger;r.debug(t,"Action.Init");g()},ProcessActions:function(n){return l(n)},ShowContent:function(){k()},GetPaywallView:function(){return lastArticleNumber}}},Connext=function(n){var e=null,t="Core",i,u={},o=!1,r,l={debug:!0,silentmode:!1,environment:null,settingsKey:null,paperCode:null,configSettings:{AccessRules:{SubscriberStatus:"L"},EnforceUniqueArticles:!1},loadType:"ajax"},a=function(){try{u.PluginStartTime=new Date;i=Connext.Logger;i.debug("init","Initializing Connext...");p(w)}catch(n){console.log("Core.Init <<EXCEPTION>>",n)}},v=function(){i.debug("closeAllTemplates","Close all Connext Templates");n(".Mg2-connext.modal").connextmodal("hide");n(".Mg2-connext[data-display-type=inline]").addClass("hide");n(".Mg2-connext[data-display-type=info-box]").addClass("hide");n(".Mg2-connext[data-display-type=banner]").addClass("hide")},y=function(){i.debug("showTrimmedContent","Show article content");n(".blurry-text").removeClass("blurry-text");n(".trimmed-text").removeClass("trimmed-text")},p=function(r){function f(t){n.jStorage.set("CustomZip",t)}var u="getZipCode";try{i.debug(t,u);n.jStorage.get("CustomZip")?r&&r():n.ajax({url:Connext.Common.IPInfo,type:"GET",success:function(n){n.zip_code?f(n.zip_code):f("00000");r&&r()},error:function(){console.log("ZIPERROR")}})}catch(e){i.exception(t,u,e)}},w=function(){var u="checkRequirements";try{if(i.debug(t,u),!window.jQuery)throw"Jquery not loaded";if(r=n.extend(!0,l,r),i.setDebug(r.debug),Connext.Utils.init(),r.loadType=="ajax"&&(n("body").find(".mg2-Connext").remove(),n("body").find(".debug_details").remove()),r.debug){Connext.Utils.CreateDebugDetailPanel();var f=Connext.Storage.GetSiteCode(),e=Connext.Storage.GetConfigCode(),o=Connext.Storage.GetIsCustomConfiguration();n("#ConnextSiteCode").val(f);n("#ConnextConfigCode").val(e);n("#ConnextCustomConfiguration").prop("checked",o);o&&(r.siteCode=f,r.configCode=e)}if(!r.siteCode)throw"No Site Code";if(!r.configCode)throw"No Config Code";r.silentmode||h()}catch(s){i.exception(t,u,s)}},s=function(){Connext.CloseTemplates();Connext.ShowTrimmedContent();o?c(Connext.Storage.GetLocalConfiguration()):h()},h=function(){var f="setDefaults",o,u;try{if(i.debug(t,f),r.environment==null)for(o=location.hostname,u=0;u<Connext.Common.Environments.length;u++)if(o.indexOf(Connext.Common.Environments[u])>=0){r.environment=Connext.Common.Environments[u];break}r.environment==null&&(r.environment="prod");r.api=Connext.Common.APIUrl[r.environment];Connext.API.init(r);Connext.Storage.init();Connext.Event.init(r);Connext.MeterCalculation.init();i.debug("OPTIONS.API",r.api);b().done(function(u){var f="setDefaults.getConfiguration() <<DONE>>";i.debug(t,f,"configuration",u);u?(i.debug(t,f,"CONFIGURATION FOUND",u),u.Settings=n.extend(!0,r.configSettings,u.Settings),u.Settings.Site=u.Site,e=u,u.Settings.Active&&(Connext.User.init(u.Settings),Connext.Campaign.init(u.Settings),Connext.Action.init(u.Settings),c(u))):(i.error(t,f,"No Config Settings Found"),Connext.Event.fire("onNoConfigSettingFound","No Config Settings Found"))}).fail(function(n){i.error(t,f,"No Config Settings Found","Error getting Config Settings",n);Connext.Event.fire("onNoConfigSettingFound","No Config Settings Found",n)})}catch(s){i.exception(t,f,s)}},b=function(){var r="getConfiguration",u=n.Deferred(),o,e;try{if(o=Connext.Storage.GetLocalConfiguration(),e=new Date,e.setDate(e.getDate()+1),e=new Date(e),i.debug(t,r,"localConfiguration",o),o){i.debug(t,r,"Found Local Configuration",o);var h=Connext.Storage.GetLastPublishDate(),c=Connext.Utils.ParseCustomDate(n.jStorage.get("CustomTime")),l=new Date(h);c?(i.debug(t,r,"No 'storedLastPublishDate', getting LastPublishDate from S3"),Connext.API.GetLastPublishDateS3().done(function(s){i.debug(t,r,"Connext.API.GetLastPublishDateS3.Done",s);try{var c=n.parseJSON(s),h=k(c,o.Settings.LastPublishDate);h?(Connext.Event.fire("onDebugNote","Current config is old."),f().done(function(n){i.debug(t,r,"getConfigurationFromServer","<<DONE>>",n);Connext.Utils.MergeConfiguration(n);Connext.Storage.SetLastPublishDate(n.Settings.LastPublishDate,e);u.resolve(n)}).fail(function(n){console.error(t,r,"getConfigurationFromServer","<<FAILS>>",n);u.reject(n)})):(Connext.Storage.SetLastPublishDate(o.Settings.LastPublishDate,e),u.resolve(o));i.debug(t,r,"isConfigOld",h)}catch(l){console.error(t,r,"Connext.API.GetLastPublishDateS3.Done => parseJSON <<EXCEPTION>>",l);Connext.Storage.SetLastPublishDate(o.Settings.LastPublishDate,e);u.resolve(o)}}).fail(function(o){i.debug(t,r,"Connext.API.GetLastPublishDateS3.Fail",o);n.jStorage.deleteKey(Connext.Common.StorageKeys.conversations.current);f().done(function(n){i.debug(t,r,"getConfigurationFromServer","<<DONE>>",n);Connext.Storage.SetLocalConfiguration(n);Connext.Storage.SetLastPublishDate(n.Settings.LastPublishDate,e);u.resolve(n)}).fail(function(n){console.error(t,r,"getConfigurationFromServer","<<FAILS>>",n);u.reject(n)})})):f().done(function(f){i.debug(t,r,"getConfigurationFromServer","<<DONE>>",f);n.jStorage.deleteKey(Connext.Common.StorageKeys.conversations.current);Connext.Storage.SetLocalConfiguration(f);Connext.Storage.SetLastPublishDate(f.Settings.LastPublishDate,e);u.resolve(f)}).fail(function(n){console.error(t,r,"getConfigurationFromServer","<<FAILS>>",n);u.reject(n)})}else f().done(function(f){i.debug(t,r,"getConfigurationFromServer","<<DONE>>",f);n.jStorage.deleteKey(Connext.Common.StorageKeys.conversations.current);Connext.Storage.SetLocalConfiguration(f);Connext.Storage.SetLastPublishDate(f.Settings.LastPublishDate,e);u.resolve(f)}).fail(function(n){console.error(t,r,"getConfigurationFromServer","<<FAILS>>",n);u.reject(n)})}catch(s){console.error(t,r,"EXCEPTION",s);u.reject(s)}return u.promise()},c=function(f){var s,c,h;try{o=!0;s="processConfiguration";i.debug(t,s);f||(f=e);u.StartProcessingTime=new Date;f.Site.SiteTheme.ThemeUrl&&f.Site.SiteTheme.ThemeUrl!=="default"?(c=Connext.Common.CSSPluginUrl[r.environment],n("#themeLink").length==0&&(n("body link").length==0?n("body").append('<link href="" id ="themeLink" rel="stylesheet">'):n('<link href="" id ="themeLink" rel="stylesheet">').insertAfter(n("body link").last())),n("#themeLink").attr("href",c+f.Site.SiteTheme.ThemeUrl)):f.Site.SiteTheme.ThemeUrl&&f.Site.SiteTheme.ThemeUrl=="default"&&n("#themeLink").remove();Connext.Event.fire("onCampaignFound",f.Campaign);Connext.User.CheckAccess().done(function(n){i.debug(t,s,"User.CheckAccess.Done",n)}).fail(function(){i.debug(t,s,"User.CheckAccess.Fail")}).always(function(){var r;Connext.MeterCalculation.CalculateMeterLevel(f.DynamicMeter.Rules).done(function(n){i.debug(t,s,"Determined meter level",n);h=n.MeterLevelId;Connext.Event.fire("onMeterLevelSet",{method:"Dynamic",level:h,rule:n})}).fail(function(){i.warn(t,s,"Failed to determined Meter Level...using default");h=f.Settings.DefaultMeterLevel;Connext.Event.fire("onMeterLevelSet",{method:"Default",level:h})}).always(function(){i.info(t,s,"METER CALCULATION --- ALWAYS CALLED",h);Connext.Campaign.ProcessCampaign(Connext.Common.MeterLevels[h],f.Campaign)});r=Connext.User.GetAuthTiming();i.debug(t,s,"User.CheckAccess.Always","UserAuthTime",r);var e=new Date,o=e.diff(u.StartProcessingTime),c=e.diff(u.PluginStartTime);n("#ddProcessingTime").html(o+"ms");n("#ddTotalProcessingTime").html(c+"ms");Connext.Event.fire("onInit",null)})}catch(l){console.log("Core.Init <<EXCEPTION>>",l)}},f=function(){var u="getConfigurationFromServer",f=n.Deferred();try{console.log(t,u);Connext.API.GetConfiguration({payload:{siteCode:r.siteCode,configCode:r.configCode},onSuccess:function(n){i.debug(t,u,"<< SUCCESS >>","data",n);var r=Connext.Utils.ProcessConfiguration(n);i.debug(t,u,"<< SUCCESS >>","processedConfiguration",r);f.resolve(r)},onNull:function(){i.debug(t,u,"<< NO RESULTS >>");f.reject("Configuration Not Found")},onError:function(n){i.debug(t,u,"<< ERROR >>","err",n);f.reject("Error Getting Configuration Data")}})}catch(e){console.error(t,u,"<<EXCEPTION>>",e)}return f.promise()},k=function(n,u){var f="isConfigurationOld",e,o,s;try{if(_.isObject(n)){if(i.debug(t,f,"s3Data",n,"OPTIONS.configCode",r.configCode),e=n[r.configCode],e)return i.log(t,f,".json file has a property same as this configCode",e),o=new Date(Date.parse(e)),s=new Date(Date.parse(u)),o>s?(i.debug(t,f,"Server date is << AFTER >>"),!0):(i.debug(t,f,"Server date is << NOT AFTER >>"),!1);throw"s3Data does not have the current configCode as a key";}else throw"s3Data is not an object";}catch(h){return console.error(t,f,"EXCEPTION",h),!0}},d=function(n,r){var u="isConfigurationOld",f,e;try{if(n)return f=new Date(Date.parse(n)),e=new Date(Date.parse(r)),f>e?(i.debug(t,u,"Server date is << AFTER >>"),!0):(i.debug(t,u,"Server date is << NOT AFTER >>"),!1)}catch(o){return console.error(t,u,"EXCEPTION",o),!0}};return{init:function(n){return r=n?n:{},a(),this},Logger:ConnextLogger(n),MeterCalculation:ConnextMeterCalculation(n),Campaign:ConnextCampaign(n),Action:ConnextAction(n),Common:ConnextCommon(),Utils:ConnextUtils(n),API:ConnextAPI(n),Event:ConnextEvents(n),Storage:ConnextStorage(n),User:ConnextUser(n),CloseTemplates:v,ShowTrimmedContent:y,Run:s,ReInit:s,GetOptions:function(){return r},ShowContent:function(){Connext.Action.ShowContent()},fire:function(n,t){console.log("Connext.fire",n,t)},EventCompleted:function(n){Connext.Campaign.EventCompleted(n)}}}(jQuery);